/*!
 * enchant.js v0.8.0
 * http://enchantjs.com
 *
 * Copyright Ubiquitous Entertainment Inc.
 * Released under the MIT license.
 */
function rand(t){return Math.floor(Math.random()*t)}function mapArrayMaker(t,e){function i(t){var i=Math.floor(Math.random()*(t.length+1));return e[i]}for(var n=[],s=0;t>s;s++){var r=i(e);n.push(r)}return n}function rand(t){return Math.floor(Math.random()*(t+1))}function randInt(t,e){return Math.floor(Math.random()*(e-t)+t)}!function(t,e){"function"!=typeof Object.defineProperty&&(Object.defineProperty=function(t,e,i){return"value"in i&&(t[e]=i.value),"get"in i&&t.__defineGetter__(e,i.get),"set"in i&&t.__defineSetter__(e,i.set),t}),"function"!=typeof Object.defineProperties&&(Object.defineProperties=function(t,e){for(var i in e)e.hasOwnProperty(i)&&Object.defineProperty(t,i,e[i]);return t}),"function"!=typeof Object.create&&(Object.create=function(t,e){function i(){}i.prototype=t;var n=new i;return null!=e&&Object.defineProperties(n,e),n}),"function"!=typeof Object.getPrototypeOf&&(Object.getPrototypeOf=function(t){return t.__proto__}),"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(e){var i=this,n=Array.prototype.slice.call(arguments,1),s=function(){},r=function(){var r=n.concat(Array.prototype.slice.call(arguments));return i.apply(this instanceof s?this:e||t,r)};return s.prototype=i.prototype,r.prototype=new s,r}),t.getTime=function(){var e;return t.performance&&t.performance.now?(e=Date.now(),function(){return e+t.performance.now()}):t.performance&&t.performance.webkitNow?(e=Date.now(),function(){return e+t.performance.webkitNow()}):Date.now}(),t.requestAnimationFrame=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame||function(){var e=t.getTime(),i=1e3/60;return function(n){var s=setTimeout(function(){e=t.getTime(),n(e)},Math.max(0,e+i-t.getTime()));return s}}();var i=function(e){if(null!=e&&(e instanceof Array||(e=Array.prototype.slice.call(arguments)),e=e.filter(function(t){return[t].join()})),function n(i,s){var r,a,o=[];for(var h in i)i.hasOwnProperty(h)&&("function"==typeof i[h]?t[h]=i[h]:"object"==typeof i[h]&&null!==i[h]&&Object.getPrototypeOf(i[h])===Object.prototype&&(null==e?o.push(h):(r=e.indexOf(s+h),-1!==r&&(o.push(h),e.splice(r,1)))));for(r=0,a=o.length;a>r;r++)n(i[o[r]],s+o[r]+".")}(i,""),i.Class.getInheritanceTree(t.Game).length<=i.Class.getInheritanceTree(t.Core).length&&(t.Game=t.Core),null!=e&&e.length)throw new Error("Cannot load module: "+e.join(", "))};t.enchant=i,t.addEventListener("message",function(t,e){try{var n=JSON.parse(t.data);if("event"===n.type)i.Core.instance.dispatchEvent(new i.Event(n.value));else if("debug"===n.type)switch(n.value){case"start":i.Core.instance.start();break;case"pause":i.Core.instance.pause();break;case"resume":i.Core.instance.resume();break;case"tick":i.Core.instance._tick()}}catch(s){}},!1),i.Class=function(t,e){return i.Class.create(t,e)},i.Class.create=function(t,e){if(null==t&&e)throw new Error("superclass is undefined (enchant.Class.create)");if(null==t)throw new Error("definition is undefined (enchant.Class.create)");if(0===arguments.length)return i.Class.create(Object,e);if(1===arguments.length&&"function"!=typeof arguments[0])return i.Class.create(Object,arguments[0]);for(var n in e)e.hasOwnProperty(n)&&("object"==typeof e[n]&&null!==e[n]&&Object.getPrototypeOf(e[n])===Object.prototype?"enumerable"in e[n]||(e[n].enumerable=!0):e[n]={value:e[n],enumerable:!0,writable:!0});var s=function(){return this instanceof s?void s.prototype.initialize.apply(this,arguments):new s};s.prototype=Object.create(t.prototype,e),s.prototype.constructor=s,null==s.prototype.initialize&&(s.prototype.initialize=function(){t.apply(this,arguments)});for(var r=this.getInheritanceTree(t),a=0,o=r.length;o>a;a++)if("function"==typeof r[a]._inherited){r[a]._inherited(s);break}return s},i.Class.getInheritanceTree=function(t){for(var e=[],i=t,n=i.prototype;i!==Object;)e.push(i),n=Object.getPrototypeOf(n),i=n.constructor;return e},i.ENV={VERSION:"0.6.1",VENDOR_PREFIX:function(){var t=navigator.userAgent;return-1!==t.indexOf("Opera")?"O":-1!==t.indexOf("MSIE")?"ms":-1!==t.indexOf("WebKit")?"webkit":"Gecko"===navigator.product?"Moz":""}(),TOUCH_ENABLED:function(){var t=document.createElement("div");return t.setAttribute("ontouchstart","return"),"function"==typeof t.ontouchstart}(),RETINA_DISPLAY:function(){if(-1!==navigator.userAgent.indexOf("iPhone")&&2===t.devicePixelRatio){var e=document.querySelector('meta[name="viewport"]');return null==e&&(e=document.createElement("meta"),document.head.appendChild(e)),e.setAttribute("content","width=640"),!0}return!1}(),USE_FLASH_SOUND:function(){var t=navigator.userAgent,e=navigator.vendor||"";return 0===location.href.indexOf("http")&&-1===t.indexOf("Mobile")&&-1!==e.indexOf("Apple")}(),USE_DEFAULT_EVENT_TAGS:["input","textarea","select","area"],CANVAS_DRAWING_METHODS:["putImageData","drawImage","drawFocusRing","fill","stroke","clearRect","fillRect","strokeRect","fillText","strokeText"],KEY_BIND_TABLE:{37:"left",38:"up",39:"right",40:"down"},PREVENT_DEFAULT_KEY_CODES:[37,38,39,40,32],SOUND_ENABLED_ON_MOBILE_SAFARI:!1,USE_WEBAUDIO:function(){return"file:"!==location.protocol}(),USE_ANIMATION:!0},i.Event=i.Class.create({initialize:function(t){this.type=t,this.target=null,this.x=0,this.y=0,this.localX=0,this.localY=0},_initPosition:function(t,e){var n=i.Core.instance;this.x=this.localX=(t-n._pageX)/n.scale,this.y=this.localY=(e-n._pageY)/n.scale}}),i.Event.LOAD="load",i.Event.ERROR="error",i.Event.CORE_RESIZE="coreresize",i.Event.PROGRESS="progress",i.Event.ENTER_FRAME="enterframe",i.Event.EXIT_FRAME="exitframe",i.Event.ENTER="enter",i.Event.EXIT="exit",i.Event.CHILD_ADDED="childadded",i.Event.ADDED="added",i.Event.ADDED_TO_SCENE="addedtoscene",i.Event.CHILD_REMOVED="childremoved",i.Event.REMOVED="removed",i.Event.REMOVED_FROM_SCENE="removedfromscene",i.Event.TOUCH_START="touchstart",i.Event.TOUCH_MOVE="touchmove",i.Event.TOUCH_END="touchend",i.Event.RENDER="render",i.Event.INPUT_START="inputstart",i.Event.INPUT_CHANGE="inputchange",i.Event.INPUT_END="inputend",i.Event.LEFT_BUTTON_DOWN="leftbuttondown",i.Event.LEFT_BUTTON_UP="leftbuttonup",i.Event.RIGHT_BUTTON_DOWN="rightbuttondown",i.Event.RIGHT_BUTTON_UP="rightbuttonup",i.Event.UP_BUTTON_DOWN="upbuttondown",i.Event.UP_BUTTON_UP="upbuttonup",i.Event.DOWN_BUTTON_DOWN="downbuttondown",i.Event.DOWN_BUTTON_UP="downbuttonup",i.Event.A_BUTTON_DOWN="abuttondown",i.Event.A_BUTTON_UP="abuttonup",i.Event.B_BUTTON_DOWN="bbuttondown",i.Event.B_BUTTON_UP="bbuttonup",i.Event.ADDED_TO_TIMELINE="addedtotimeline",i.Event.REMOVED_FROM_TIMELINE="removedfromtimeline",i.Event.ACTION_START="actionstart",i.Event.ACTION_END="actionend",i.Event.ACTION_TICK="actiontick",i.Event.ACTION_ADDED="actionadded",i.Event.ACTION_REMOVED="actionremoved",i.EventTarget=i.Class.create({initialize:function(){this._listeners={}},addEventListener:function(t,e){var i=this._listeners[t];null==i?this._listeners[t]=[e]:-1===i.indexOf(e)&&i.unshift(e)},on:function(){this.addEventListener.apply(this,arguments)},removeEventListener:function(t,e){var i=this._listeners[t];if(null!=i){var n=i.indexOf(e);-1!==n&&i.splice(n,1)}},clearEventListener:function(t){null!=t?delete this._listeners[t]:this._listeners={}},dispatchEvent:function(t){t.target=this,t.localX=t.x-this._offsetX,t.localY=t.y-this._offsetY,null!=this["on"+t.type]&&this["on"+t.type](t);var e=this._listeners[t.type];if(null!=e){e=e.slice();for(var i=0,n=e.length;n>i;i++)e[i].call(this,t)}}}),function(){var e;i.Core=i.Class.create(i.EventTarget,{initialize:function(n,s){if(null===t.document.body)throw new Error("document.body is null. Please excute 'new Core()' in window.onload.");i.EventTarget.call(this);var r=!0;e&&(r=!1,e.stop()),e=i.Core.instance=this,this._calledTime=0,this._mousedownID=0,this._surfaceID=0,this._soundID=0,this._scenes=[],n=n||320,s=s||320;var a,o,h,c=document.getElementById("enchant-stage");if(c){var l=t.getComputedStyle(c);for(o=parseInt(l.width,10),h=parseInt(l.height,10),a=o&&h?Math.min(o/n,h/s):1;c.firstChild;)c.removeChild(c.firstChild);c.style.position="relative";var d=c.getBoundingClientRect();this._pageX=Math.round(t.scrollX||t.pageXOffset+d.left),this._pageY=Math.round(t.scrollY||t.pageYOffset+d.top)}else c=document.createElement("div"),c.id="enchant-stage",c.style.position="absolute",document.body.firstChild?document.body.insertBefore(c,document.body.firstChild):document.body.appendChild(c),a=Math.min(t.innerWidth/n,t.innerHeight/s),this._pageX=0,this._pageY=0;c.style.fontSize="12px",c.style.webkitTextSizeAdjust="none",c.style.webkitTapHighlightColor="rgba(0, 0, 0, 0)",this._element=c,this.addEventListener("coreresize",this._oncoreresize),this._width=n,this._height=s,this.scale=a,this.fps=30,this.frame=0,this.ready=!1,this.running=!1,this.assets={};this._assets=[];!function _(t){t.assets&&i.Core.instance.preload(t.assets);for(var e in t)t.hasOwnProperty(e)&&"object"==typeof t[e]&&null!==t[e]&&Object.getPrototypeOf(t[e])===Object.prototype&&_(t[e])}(i),this.currentScene=null,this.rootScene=new i.Scene,this.pushScene(this.rootScene),this.loadingScene=new i.LoadingScene,this._activated=!1,this._offsetX=0,this._offsetY=0,this.input={},i.ENV.KEY_BIND_TABLE||(i.ENV.KEY_BIND_TABLE={}),this._keybind=i.ENV.KEY_BIND_TABLE,this.pressedKeysNum=0,this._internalButtondownListeners={},this._internalButtonupListeners={};for(var u in this._keybind)this.keybind(u,this._keybind[u]);if(r){c=i.Core.instance._element;var f;document.addEventListener("keydown",function(t){if(e.dispatchEvent(new i.Event("keydown")),-1!==i.ENV.PREVENT_DEFAULT_KEY_CODES.indexOf(t.keyCode)&&(t.preventDefault(),t.stopPropagation()),e.running){var n=e._keybind[t.keyCode];n&&(f=new i.Event(n+"buttondown"),e.dispatchEvent(f))}},!0),document.addEventListener("keyup",function(t){if(e.running){var n=e._keybind[t.keyCode];n&&(f=new i.Event(n+"buttonup"),e.dispatchEvent(f))}},!0),i.ENV.TOUCH_ENABLED&&(c.addEventListener("touchstart",function(t){var n=t.target.tagName.toLowerCase();-1===i.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(n)&&(t.preventDefault(),e.running||t.stopPropagation())},!0),c.addEventListener("touchmove",function(t){var n=t.target.tagName.toLowerCase();-1===i.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(n)&&(t.preventDefault(),e.running||t.stopPropagation())},!0),c.addEventListener("touchend",function(t){var n=t.target.tagName.toLowerCase();-1===i.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(n)&&(t.preventDefault(),e.running||t.stopPropagation())},!0)),c.addEventListener("mousedown",function(t){var n=t.target.tagName.toLowerCase();-1===i.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(n)&&(t.preventDefault(),e._mousedownID++,e.running||t.stopPropagation())},!0),c.addEventListener("mousemove",function(t){var n=t.target.tagName.toLowerCase();-1===i.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(n)&&(t.preventDefault(),e.running||t.stopPropagation())},!0),c.addEventListener("mouseup",function(t){var n=t.target.tagName.toLowerCase();-1===i.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(n)&&(t.preventDefault(),e.running||t.stopPropagation())},!0),e._touchEventTarget={},i.ENV.TOUCH_ENABLED&&(c.addEventListener("touchstart",function(t){for(var e,n,s=i.Core.instance,r=new i.Event(i.Event.TOUCH_START),a=t.changedTouches,o=0,h=a.length;h>o;o++)e=a[o],r._initPosition(e.pageX,e.pageY),n=s.currentScene._determineEventTarget(r),s._touchEventTarget[e.identifier]=n,n.dispatchEvent(r)},!1),c.addEventListener("touchmove",function(t){for(var e,n,s=i.Core.instance,r=new i.Event(i.Event.TOUCH_MOVE),a=t.changedTouches,o=0,h=a.length;h>o;o++)e=a[o],n=s._touchEventTarget[e.identifier],n&&(r._initPosition(e.pageX,e.pageY),n.dispatchEvent(r))},!1),c.addEventListener("touchend",function(t){for(var e,n,s=i.Core.instance,r=new i.Event(i.Event.TOUCH_END),a=t.changedTouches,o=0,h=a.length;h>o;o++)e=a[o],n=s._touchEventTarget[e.identifier],n&&(r._initPosition(e.pageX,e.pageY),n.dispatchEvent(r),delete s._touchEventTarget[e.identifier])},!1)),c.addEventListener("mousedown",function(t){var e=i.Core.instance,n=new i.Event(i.Event.TOUCH_START);n._initPosition(t.pageX,t.pageY);var s=e.currentScene._determineEventTarget(n);e._touchEventTarget[e._mousedownID]=s,s.dispatchEvent(n)},!1),c.addEventListener("mousemove",function(t){var e=i.Core.instance,n=new i.Event(i.Event.TOUCH_MOVE);n._initPosition(t.pageX,t.pageY);var s=e._touchEventTarget[e._mousedownID];s&&s.dispatchEvent(n)},!1),c.addEventListener("mouseup",function(t){var e=i.Core.instance,n=new i.Event(i.Event.TOUCH_END);n._initPosition(t.pageX,t.pageY);var s=e._touchEventTarget[e._mousedownID];s&&s.dispatchEvent(n),delete e._touchEventTarget[e._mousedownID]},!1)}},width:{get:function(){return this._width},set:function(t){this._width=t,this._dispatchCoreResizeEvent()}},height:{get:function(){return this._height},set:function(t){this._height=t,this._dispatchCoreResizeEvent()}},scale:{get:function(){return this._scale},set:function(t){this._scale=t,this._dispatchCoreResizeEvent()}},_dispatchCoreResizeEvent:function(){var t=new i.Event("coreresize");t.width=this._width,t.height=this._height,t.scale=this._scale,this.dispatchEvent(t)},_oncoreresize:function(t){this._element.style.width=Math.floor(this._width*this._scale)+"px",this._element.style.height=Math.floor(this._height*this._scale)+"px";for(var e,i=0,n=this._scenes.length;n>i;i++)e=this._scenes[i],e.dispatchEvent(t)},preload:function(t){var e;if(!(t instanceof Array))if("object"==typeof t){e=[];for(var i in t)t.hasOwnProperty(i)&&e.push([t[i],i]);t=e}else t=Array.prototype.slice.call(arguments);return Array.prototype.push.apply(this._assets,t),this},load:function(t,n,s,r){var a,o;"string"==typeof arguments[1]?(a=n,o=1):(a=t,o=0),s=arguments[1+o]||function(){},r=arguments[2+o]||function(){};var h=i.Core.findExt(t);return i.Deferred.next(function(){var n=new i.Deferred,o=function(t){n.call(t),s.call(this,t)},c=function(t){n.fail(t),r.call(this,t)};if(i.Core._loadFuncs[h])i.Core.instance.assets[a]=i.Core._loadFuncs[h](t,h,o,c);else{var l=new XMLHttpRequest;l.open("GET",t,!0),l.onreadystatechange=function(){if(4===l.readyState){if(200!==l.status&&0!==l.status){var n=new i.Event("error");n.message=l.status+": Cannot load an asset: "+t,c.call(i.Core.instance,n)}var s=l.getResponseHeader("Content-Type")||"";s.match(/^image/)?e.assets[a]=i.Surface.load(t,o,c):s.match(/^audio/)?e.assets[a]=i.Sound.load(t,s,o,c):(e.assets[a]=l.responseText,o.call(i.Core.instance,new i.Event("laod")))}},l.send(null)}return n})},start:function(n){var s=function(){this.frame=0,this.removeEventListener("load",s)};if(this.addEventListener("load",s),this.currentTime=t.getTime(),this.running=!0,this.ready=!0,!this._activated&&(this._activated=!0,i.ENV.SOUND_ENABLED_ON_MOBILE_SAFARI&&!e._touched&&(-1!==navigator.userAgent.indexOf("iPhone OS")||-1!==navigator.userAgent.indexOf("iPad")))){var r=new i.Deferred,a=new i.Scene;a.backgroundColor="#000";var o=Math.round(e.width/10),h=new i.Sprite(e.width,o);h.y=(e.height-o)/2,h.image=new i.Surface(e.width,o),h.image.context.fillStyle="#fff",h.image.context.font=o-1+"px bold Helvetica,Arial,sans-serif";var c=h.image.context.measureText("Touch to Start").width;return h.image.context.fillText("Touch to Start",(e.width-c)/2,o-1),a.addChild(h),document.addEventListener("mousedown",function d(){document.removeEventListener("mousedown",d),e._touched=!0,e.removeScene(a),e.start(r)},!1),e.pushScene(a),r}this._requestNextFrame(0);var l=this._requestPreload().next(function(){i.Core.instance.loadingScene.dispatchEvent(new i.Event(i.Event.LOAD))});return n&&l.next(function(t){n.call(t)}).error(function(t){n.fail(t)}),l},_requestPreload:function(){var t={},n=0,s=0,r=function(){var t=new i.Event("progress");t.loaded=++n,t.total=s,e.loadingScene.dispatchEvent(t)};return this._assets.reverse().forEach(function(e){var i,n;e instanceof Array?(i=e[0],n=e[1]):i=n=e,t[n]||(t[n]=this.load(i,n,r),s++)},this),this.pushScene(this.loadingScene),i.Deferred.parallel(t)},debug:function(){return this._debug=!0,this.start()},actualFps:{get:function(){return this._actualFps||this.fps}},_requestNextFrame:function(e){this.ready&&(this.fps>=60||16>=e?(this._calledTime=t.getTime(),t.requestAnimationFrame(this._callTick)):setTimeout(function(){var e=i.Core.instance;e._calledTime=t.getTime(),t.requestAnimationFrame(e._callTick)},Math.max(0,e)))},_callTick:function(t){i.Core.instance._tick(t)},_tick:function(e){var n=new i.Event("enterframe"),s=t.getTime(),r=n.elapsed=s-this.currentTime;this._actualFps=r>0?1e3/r:0;for(var a=this.currentScene.childNodes.slice(),o=Array.prototype.push;a.length;){var h=a.pop();h.age++,h.dispatchEvent(n),h.childNodes&&o.apply(a,h.childNodes)}this.currentScene.age++,this.currentScene.dispatchEvent(n),this.dispatchEvent(n),this.dispatchEvent(new i.Event("exitframe")),this.frame++,s=t.getTime(),this.currentTime=s,this._requestNextFrame(1e3/this.fps-(s-this._calledTime))},getTime:function(){return t.getTime()},stop:function(){this.ready=!1,this.running=!1},pause:function(){this.ready=!1},resume:function(){this.ready||(this.currentTime=t.getTime(),this.ready=!0,this.running=!0,this._requestNextFrame(0))},pushScene:function(t){return this._element.appendChild(t._element),this.currentScene&&this.currentScene.dispatchEvent(new i.Event("exit")),this.currentScene=t,this.currentScene.dispatchEvent(new i.Event("enter")),this._scenes.push(t)},popScene:function(){return this.currentScene===this.rootScene?this.currentScene:(this._element.removeChild(this.currentScene._element),this.currentScene.dispatchEvent(new i.Event("exit")),this.currentScene=this._scenes[this._scenes.length-2],this.currentScene.dispatchEvent(new i.Event("enter")),this._scenes.pop())},replaceScene:function(t){return this.popScene(),this.pushScene(t)},removeScene:function(t){if(this.currentScene===t)return this.popScene();var e=this._scenes.indexOf(t);return-1!==e?(this._scenes.splice(e,1),this._element.removeChild(t._element),t):null},keybind:function(t,e){this._keybind[t]=e;var n=function(t){var n;this.input[e]||(this.input[e]=!0,n=new i.Event(this.pressedKeysNum++?"inputchange":"inputstart"),this.dispatchEvent(n),this.currentScene.dispatchEvent(n)),this.currentScene.dispatchEvent(t)},s=function(t){var n;this.input[e]&&(this.input[e]=!1,n=new i.Event(--this.pressedKeysNum?"inputchange":"inputend"),this.dispatchEvent(n),this.currentScene.dispatchEvent(n)),this.currentScene.dispatchEvent(t)};return this.addEventListener(e+"buttondown",n),this.addEventListener(e+"buttonup",s),this._internalButtondownListeners[t]=n,this._internalButtonupListeners[t]=s,this},keyunbind:function(t){if(!this._keybind[t])return this;var e=this._internalButtondownListeners,i=this._internalButtonupListeners;return this.removeEventListener(t+"buttondown",e),this.removeEventListener(t+"buttonup",i),delete e[t],delete i[t],delete this._keybind[t],this},getElapsedTime:function(){return this.frame/this.fps}}),i.Core._loadFuncs={},i.Core._loadFuncs.jpg=i.Core._loadFuncs.jpeg=i.Core._loadFuncs.gif=i.Core._loadFuncs.png=i.Core._loadFuncs.bmp=function(t,e,n,s){return i.Surface.load(t,n,s)},i.Core._loadFuncs.mp3=i.Core._loadFuncs.aac=i.Core._loadFuncs.m4a=i.Core._loadFuncs.wav=i.Core._loadFuncs.ogg=function(t,e,n,s){return i.Sound.load(t,"audio/"+e,n,s)},i.Core.findExt=function(t){var e=t.match(/\.\w+$/);return e&&e.length>0?e[0].slice(1).toLowerCase():0===t.indexOf("data:")?t.split(/[\/;]/)[1].toLowerCase():null},i.Core.instance=null}(),i.Game=i.Core,i.Node=i.Class.create(i.EventTarget,{initialize:function(){if(i.EventTarget.call(this),this._dirty=!1,this._matrix=[1,0,0,1,0,0],this._x=0,this._y=0,this._offsetX=0,this._offsetY=0,this.age=0,this.parentNode=null,this.scene=null,this.addEventListener("touchstart",function(t){this.parentNode&&this.parentNode.dispatchEvent(t)}),this.addEventListener("touchmove",function(t){this.parentNode&&this.parentNode.dispatchEvent(t)}),this.addEventListener("touchend",function(t){this.parentNode&&this.parentNode.dispatchEvent(t)}),i.ENV.USE_ANIMATION){this.tl=new i.Timeline(this)}},moveTo:function(t,e){this._x=t,this._y=e,this._dirty=!0},moveBy:function(t,e){this._x+=t,this._y+=e,this._dirty=!0},x:{get:function(){return this._x},set:function(t){this._x=t,this._dirty=!0}},y:{get:function(){return this._y},set:function(t){this._y=t,this._dirty=!0}},_updateCoordinate:function(){var t=this,e=[t],n=t.parentNode;for(this.scene;n&&t._dirty;)e.unshift(n),t=t.parentNode,n=t.parentNode;var s,r,a,o=i.Matrix.instance,h=o.stack,c=[];h.push(e[0]._matrix);for(var l=1,d=e.length;d>l;l++){t=e[l],s=[],o.makeTransformMatrix(t,c),o.multiply(h[h.length-1],c,s),t._matrix=s,h.push(s),r="number"==typeof t._originX?t._originX:t._width/2||0,a="number"==typeof t._originY?t._originY:t._height/2||0;var u=[r,a];o.multiplyVec(s,u,u),t._offsetX=u[0]-r,t._offsetY=u[1]-a,t._dirty=!1}o.reset()},remove:function(){this._listener&&this.clearEventListener(),this.parentNode&&this.parentNode.removeChild(this)}});var n=function(t,e){for(var i,n=[],s=0,r=t.collection.length;r>s;s++)i=t.collection[s],e._intersectOne(i)&&n.push(i);return n},s=function(t,e){for(var i,n,s=[],r=0,a=t.collection.length;a>r;r++){i=t.collection[r];for(var o=0,h=e.collection.length;h>o;o++)n=e.collection[o],i._intersectOne(n)&&s.push([i,n])}return s},r=function(t,e){for(var i,n=[],s=0,r=t.collection.length;r>s;s++)i=t.collection[s],e._intersectStrictOne(i)&&n.push(i);return n},a=function(t,e){for(var i,n,s=[],r=0,a=t.collection.length;a>r;r++){i=t.collection[r];for(var o=0,h=e.collection.length;h>o;o++)n=e.collection[o],i._intersectStrictOne(n)&&s.push([i,n])}return s},o=function(t){return t instanceof i.Entity?n(this,t):"function"==typeof t&&t.collection?s(this,t):!1},h=function(t){return t instanceof i.Entity?r(this,t):"function"==typeof t&&t.collection?a(this,t):!1};i.Entity=i.Class.create(i.Node,{initialize:function(){var t=i.Core.instance;i.Node.call(this),this._rotation=0,this._scaleX=1,this._scaleY=1,this._touchEnabled=!0,this._clipping=!1,this._originX=null,this._originY=null,this._width=0,this._height=0,this._backgroundColor=null,this._debugColor="#0000ff",this._opacity=1,this._visible=!0,this._buttonMode=null,this._style={},this.__styleStatus={},this.compositeOperation=null,this.buttonMode=null,this.buttonPressed=!1,this.addEventListener("touchstart",function(){if(this.buttonMode){this.buttonPressed=!0;var e=new i.Event(this.buttonMode+"buttondown");this.dispatchEvent(e),t.dispatchEvent(e)}}),this.addEventListener("touchend",function(){if(this.buttonMode){this.buttonPressed=!1;var e=new i.Event(this.buttonMode+"buttonup");this.dispatchEvent(e),t.dispatchEvent(e)}}),this.enableCollection()},width:{get:function(){return this._width},set:function(t){this._width=t,this._dirty=!0}},height:{get:function(){return this._height},set:function(t){this._height=t,this._dirty=!0}},backgroundColor:{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t}},debugColor:{get:function(){return this._debugColor},set:function(t){this._debugColor=t}},opacity:{get:function(){return this._opacity},set:function(t){this._opacity=parseFloat(t)}},visible:{get:function(){return this._visible},set:function(t){this._visible=t}},touchEnabled:{get:function(){return this._touchEnabled},set:function(t){this._touchEnabled=t,t?this._style.pointerEvents="all":this._style.pointerEvents="none"}},intersect:function(t){return t instanceof i.Entity?this._intersectOne(t):"function"==typeof t&&t.collection?n(t,this):!1},_intersectOne:function(t){return this._dirty&&this._updateCoordinate(),t._dirty&&t._updateCoordinate(),this._offsetX<t._offsetX+t.width&&t._offsetX<this._offsetX+this.width&&this._offsetY<t._offsetY+t.height&&t._offsetY<this._offsetY+this.height},intersectStrict:function(t){return t instanceof i.Entity?this._intersectStrictOne(t):"function"==typeof t&&t.collection?r(t,this):!1},_intersectStrictOne:function(t){this._dirty&&this._updateCoordinate(),t._dirty&&t._updateCoordinate();var e,i,n,s,r,a,o,h,c,l,d,u,f,_,v,g,m,p,E,y,w,x,C,T=this.getOrientedBoundingRect(),b=t.getOrientedBoundingRect(),S=T.leftTop,M=T.rightTop,N=T.leftBottom,O=T.rightBottom,A=b.leftTop,L=b.rightTop,D=b.leftBottom,I=b.rightBottom,R=S[0],k=S[1],P=M[0],U=M[1],B=N[0],X=N[1],Y=O[0],z=O[1],F=A[0],V=A[1],H=L[0],G=L[1],W=D[0],q=D[1],j=I[0],K=I[1],Q=[P-R,U-k],Z=[Y-P,z-U],J=[B-Y,X-z],$=[R-B,k-X],tt=[H-F,G-V],et=[j-H,K-G],it=[W-j,q-K],nt=[F-W,V-q],st=R+P+B+Y>>2,rt=k+U+X+z>>2,at=F+H+W+j>>2,ot=V+G+q+K>>2;if(Q[0]*(ot-k)-Q[1]*(at-R)>0&&Z[0]*(ot-U)-Z[1]*(at-P)>0&&J[0]*(ot-z)-J[1]*(at-Y)>0&&$[0]*(ot-X)-$[1]*(at-B)>0)return!0;if(tt[0]*(rt-V)-tt[1]*(st-F)>0&&et[0]*(rt-G)-et[1]*(st-H)>0&&it[0]*(rt-K)-it[1]*(st-j)>0&&nt[0]*(rt-q)-nt[1]*(st-W)>0)return!0;for(n=[S,M,O,N],s=[A,L,I,D],r=[Q,Z,J,$],a=[tt,et,it,nt],e=0;4>e;e++)for(o=n[e],d=o[0],u=o[1],c=r[e],v=c[0],g=c[1],i=0;4>i;i++)if(h=s[i],f=h[0],_=h[1],l=a[i],m=l[0],p=l[1],w=v*p-g*m,0!==w&&(E=f-d,y=_-u,x=(E*g-y*v)/w,C=(E*p-y*m)/w,x>0&&1>x&&C>0&&1>C))return!0;return!1},within:function(t,e){this._dirty&&this._updateCoordinate(),t._dirty&&t._updateCoordinate(),null==e&&(e=(this.width+this.height+t.width+t.height)/4);var i;return(i=this._offsetX-t._offsetX+(this.width-t.width)/2)*i+(i=this._offsetY-t._offsetY+(this.height-t.height)/2)*i<e*e},scale:function(t,e){this._scaleX*=t,this._scaleY*=null!=e?e:t,this._dirty=!0},rotate:function(t){this._rotation+=t,this._dirty=!0},scaleX:{get:function(){return this._scaleX},set:function(t){this._scaleX=t,this._dirty=!0}},scaleY:{get:function(){return this._scaleY},set:function(t){this._scaleY=t,this._dirty=!0}},rotation:{get:function(){return this._rotation},set:function(t){this._rotation=t,this._dirty=!0}},originX:{get:function(){return this._originX},set:function(t){this._originX=t,this._dirty=!0}},originY:{get:function(){return this._originY},set:function(t){this._originY=t,this._dirty=!0}},enableCollection:function(){this.addEventListener("addedtoscene",this._addSelfToCollection),this.addEventListener("removedfromscene",this._removeSelfFromCollection),this.scene&&this._addSelfToCollection()},disableCollection:function(){this.removeEventListener("addedtoscene",this._addSelfToCollection),this.removeEventListener("removedfromscene",this._removeSelfFromCollection),this.scene&&this._removeSelfFromCollection()},_addSelfToCollection:function(){var t=this.getConstructor();t._collectionTarget.forEach(function(t){t.collection.push(this)},this)},_removeSelfFromCollection:function(){var t=this.getConstructor();t._collectionTarget.forEach(function(t){var e=t.collection.indexOf(this);-1!==e&&t.collection.splice(e,1)},this)},getBoundingRect:function(){var t=this.width||0,e=this.height||0,i=this._matrix,n=i[0]*t,s=i[1]*t,r=i[2]*e,a=i[3]*e,o=i[4],h=i[5],c=[o,n+o,r+o,n+r+o].sort(function(t,e){return t-e}),l=[h,s+h,a+h,s+a+h].sort(function(t,e){return t-e});return{left:c[0],top:l[0],width:c[3]-c[0],height:l[3]-l[0]}},getOrientedBoundingRect:function(){var t=this.width||0,e=this.height||0,i=this._matrix,n=i[0]*t,s=i[1]*t,r=i[2]*e,a=i[3]*e,o=i[4],h=i[5];return{leftTop:[o,h],rightTop:[n+o,s+h],leftBottom:[r+o,a+h],rightBottom:[n+r+o,s+a+h]}},getConstructor:function(){return Object.getPrototypeOf(this).constructor}});var c=function(t){if(!t._collective){var e=i.Class.getInheritanceTree(t),n=e.indexOf(i.Entity);-1!==n?t._collectionTarget=e.splice(0,n+1):t._collectionTarget=[],t.intersect=o,t.intersectStrict=h,t.collection=[],t._collective=!0}};c(i.Entity),i.Entity._inherited=function(t){c(t)},i.Sprite=i.Class.create(i.Entity,{initialize:function(t,e){i.Entity.call(this),this.width=t,this.height=e,this._image=null,this._debugColor="#ff0000",this._frameLeft=0,this._frameTop=0,this._frame=0,this._frameSequence=[],this.addEventListener("enterframe",function(){if(0!==this._frameSequence.length){var t=this._frameSequence.shift();null===t?this._frameSequence=[]:(this._setFrame(t),this._frameSequence.push(t))}})},image:{get:function(){return this._image},set:function(t){if(t===e)throw new Error("Assigned value on Sprite.image is undefined. Please double-check image path, and check if the image you want to use is preload before use.");t!==this._image&&(this._image=t,this._setFrame(this._frame))}},frame:{get:function(){return this._frame},set:function(t){if(this._frame!==t)if(t instanceof Array){var e=t,i=e.shift();this._setFrame(i),e.push(i),this._frameSequence=e}else this._setFrame(t),this._frameSequence=[],this._frame=t}},_setFrame:function(t){var e,i=this._image;null!=i&&(this._frame=t,e=i.width/this._width|0,this._frameLeft=(t%e|0)*this._width,this._frameTop=(t/e|0)*this._height%i.height)},width:{get:function(){return this._width},set:function(t){this._width=t,this._setFrame(this._frame),this._dirty=!0}},height:{get:function(){return this._height},set:function(t){this._height=t,this._setFrame(this._frame),this._dirty=!0}},cvsRender:function(t){var e,n,s,r,a,o,h,c=this._image,l=this._width,d=this._height;c&&0!==l&&0!==d&&(e=c.width,n=c.height,l>e||d>n?(t.fillStyle=i.Surface._getPattern(c),t.fillRect(0,0,l,d)):(s=c._element,r=this._frameLeft,a=Math.min(this._frameTop,n-d),o=Math.max(.01,Math.min(e-r,l)),h=Math.max(.01,Math.min(n-a,d)),t.drawImage(s,r,a,o,h,0,0,l,d)))},domRender:function(){return"ms"===i.ENV.VENDOR_PREFIX?function(t){this._image&&(this._image._css?(this._style["background-image"]=this._image._css,this._style["background-position"]=-this._frameLeft+"px "+-this._frameTop+"px"):this._image._element)}:function(t){this._image&&(this._image._css?(this._style["background-image"]=this._image._css,this._style["background-position"]=-this._frameLeft+"px "+-this._frameTop+"px"):this._image._element)}}()}),i.Label=i.Class.create(i.Entity,{initialize:function(t){i.Entity.call(this),this.text=t||"",this.width=300,this.font="14px serif",this.textAlign="left",this._debugColor="#ff0000"},width:{get:function(){return this._width},set:function(t){this._width=t,this._dirty=!0,this.updateBoundArea()}},text:{get:function(){return this._text},set:function(t){if(t=""+t,this._text!==t){this._text=t,t=t.replace(/<(br|BR) ?\/?>/g,"<br/>"),this._splitText=t.split("<br/>"),this.updateBoundArea();for(var e=0,i=this._splitText.length;i>e;e++){t=this._splitText[e];var n=this.getMetrics(t);this._splitText[e]={},this._splitText[e].text=t,this._splitText[e].height=n.height}}}},textAlign:{get:function(){return this._style["text-align"]},set:function(t){this._style["text-align"]=t,this.updateBoundArea()}},font:{get:function(){return this._style.font},set:function(t){this._style.font=t,this.updateBoundArea()}},color:{get:function(){return this._style.color},set:function(t){this._style.color=t}},strokeColor:{get:function(){return this._style.strokeColor},set:function(t){this._style.strokeColor=t}},cvsRender:function(t){var e,i,n,s,r,a,o,h,c,l=0,d=this.width;if(this._splitText){t.textBaseline="top",t.font=this.font,t.fillStyle=this.color||"#000000",t.strokeStyle=this.strokeColor||"transparent",i=t.measureText(" ").width,n=d/i;for(var u=0,f=this._splitText.length;f>u;u++){for(s=this._splitText[u],r=s.text,a=0;r.length>a+n||t.measureText(r.slice(a,a+n)).width>d;){for(o="",h=n,c=0;h>0;)t.measureText(o).width<d?(c+=h,o=r.slice(a,a+c)):(c-=h,o=r.slice(a,a+c)),h=h/2|0;t.fillText(o,0,l),l+=s.height-1,a+=c}o=r.slice(a,a+r.length),e="right"===this.textAlign?d-t.measureText(o).width:"center"===this.textAlign?(d-t.measureText(o).width)/2:0,t.fillText(o,e,l),t.strokeText(o,e,l),l+=s.height-1}}},domRender:function(t){t.innerHTML!==this._text&&(t.innerHTML=this._text)},detectRender:function(t){t.fillRect(this._boundOffset,0,this._boundWidth,this._boundHeight)},updateBoundArea:function(){var t=this.getMetrics();this._boundWidth=t.width,this._boundHeight=t.height,"right"===this.textAlign?this._boundOffset=this.width-this._boundWidth:"center"===this.textAlign?this._boundOffset=(this.width-this._boundWidth)/2:this._boundOffset=0},getMetrics:function(t){var e,i={};if(document.body){e=document.createElement("div");for(var n in this._style)"width"!==n&&"height"!==n&&(e.style[n]=this._style[n]);t=t||this._text,e.innerHTML=t.replace(/ /g,"&nbsp;"),e.style.whiteSpace="noWrap",e.style.lineHeight=1,document.body.appendChild(e),
i.height=parseInt(getComputedStyle(e).height,10)+1,e.style.position="absolute",i.width=parseInt(getComputedStyle(e).width,10)+1,document.body.removeChild(e)}else i.width=this.width,i.height=this.height;return i}}),i.Map=i.Class.create(i.Entity,{initialize:function(t,e){var n=i.Core.instance;i.Entity.call(this);var s=new i.Surface(n.width,n.height);this._surface=s;var r=s._element;r.style.position="absolute",i.ENV.RETINA_DISPLAY&&2===n.scale?(r.width=2*n.width,r.height=2*n.height,this._style.webkitTransformOrigin="0 0",this._style.webkitTransform="scale(0.5)"):(r.width=n.width,r.height=n.height),this._context=r.getContext("2d"),this._tileWidth=t||0,this._tileHeight=e||0,this._image=null,this._data=[[[]]],this._dirty=!1,this._tight=!1,this.touchEnabled=!1,this.collisionData=null,this._listeners.render=null,this.addEventListener("render",function(){if(this._dirty||null==this._previousOffsetX)this.redraw(0,0,n.width,n.height);else if(this._offsetX!==this._previousOffsetX||this._offsetY!==this._previousOffsetY)if(this._tight){var t=-this._offsetX,e=-this._offsetY,i=-this._previousOffsetX,s=-this._previousOffsetY,r=t-i+n.width,a=i-t+n.width,o=e-s+n.height,h=s-e+n.height;if(r>this._tileWidth&&a>this._tileWidth&&o>this._tileHeight&&h>this._tileHeight){var c,l,d,u,f,_;a>r?(c=0,d=i-t,f=r):(c=t-i,d=0,f=a),h>o?(l=0,u=s-e,_=o):(l=e-s,u=0,_=h),null==n._buffer&&(n._buffer=document.createElement("canvas"),n._buffer.width=this._context.canvas.width,n._buffer.height=this._context.canvas.height);var v=n._buffer.getContext("2d");this._doubledImage?(v.clearRect(0,0,2*f,2*_),v.drawImage(this._context.canvas,2*c,2*l,2*f,2*_,0,0,2*f,2*_),v=this._context,v.clearRect(2*d,2*u,2*f,2*_),v.drawImage(n._buffer,0,0,2*f,2*_,2*d,2*u,2*f,2*_)):(v.clearRect(0,0,f,_),v.drawImage(this._context.canvas,c,l,f,_,0,0,f,_),v=this._context,v.clearRect(d,u,f,_),v.drawImage(n._buffer,0,0,f,_,d,u,f,_)),0===d?this.redraw(f,0,n.width-f,n.height):this.redraw(0,0,n.width-f,n.height),0===u?this.redraw(0,_,n.width,n.height-_):this.redraw(0,0,n.width,n.height-_)}else this.redraw(0,0,n.width,n.height)}else this.redraw(0,0,n.width,n.height);this._previousOffsetX=this._offsetX,this._previousOffsetY=this._offsetY})},loadData:function(t){this._data=Array.prototype.slice.apply(arguments),this._dirty=!0,this._tight=!1;for(var e=0,i=this._data.length;i>e;e++){var n=0;t=this._data[e];for(var s=0,r=t.length;r>s;s++)for(var a=0,o=t[s].length;o>a;a++)t[s][a]>=0&&n++;if(n/(t.length*t[0].length)>.2){this._tight=!0;break}}},checkTile:function(t,e){if(0>t||this.width<=t||0>e||this.height<=e)return!1;var i=this._image.width,n=this._image.height,s=this._tileWidth||i,r=this._tileHeight||n;t=t/s|0,e=e/r|0;var a=this._data[0];return a[e][t]},hitTest:function(t,e){if(0>t||this.width<=t||0>e||this.height<=e)return!1;var i=this._image.width,n=this._image.height,s=this._tileWidth||i,r=this._tileHeight||n;if(t=t/s|0,e=e/r|0,null!=this.collisionData)return this.collisionData[e]&&!!this.collisionData[e][t];for(var a=0,o=this._data.length;o>a;a++){var h,c=this._data[a];if(null!=c[e]&&null!=(h=c[e][t])&&h>=0&&(i/s|0)*(n/r|0)>h)return!0}return!1},image:{get:function(){return this._image},set:function(t){var e=i.Core.instance;if(this._image=t,i.ENV.RETINA_DISPLAY&&2===e.scale){for(var n=new i.Surface(2*t.width,2*t.height),s=this._tileWidth||t.width,r=this._tileHeight||t.height,a=t.width/s|0,o=t.height/r|0,h=0;o>h;h++)for(var c=0;a>c;c++)n.draw(t,c*s,h*r,s,r,c*s*2,h*r*2,2*s,2*r);this._doubledImage=n}this._dirty=!0}},tileWidth:{get:function(){return this._tileWidth},set:function(t){this._tileWidth=t,this._dirty=!0}},tileHeight:{get:function(){return this._tileHeight},set:function(t){this._tileHeight=t,this._dirty=!0}},width:{get:function(){return this._tileWidth*this._data[0][0].length}},height:{get:function(){return this._tileHeight*this._data[0].length}},redraw:function(t,e,i,n){if(null!=this._image){var s,r,a,o,h;this._doubledImage?(s=this._doubledImage,r=2*this._tileWidth,a=2*this._tileHeight,o=2*-this._offsetX,h=2*-this._offsetY,t*=2,e*=2,i*=2,n*=2):(s=this._image,r=this._tileWidth,a=this._tileHeight,o=-this._offsetX,h=-this._offsetY);var c=s.width/r|0,l=s.height/a|0,d=Math.max((t+o)/r|0,0),u=Math.max((e+h)/a|0,0),f=Math.ceil((t+o+i)/r),_=Math.ceil((e+h+n)/a),v=s._element,g=this._context;g.canvas;g.clearRect(t,e,i,n);for(var m=0,p=this._data.length;p>m;m++){var E=this._data[m],y=Math.min(f,E[0].length),w=Math.min(_,E.length);for(e=u;w>e;e++)for(t=d;y>t;t++){var x=E[e][t];if(x>=0&&c*l>x){var C=x%c*r,T=(x/c|0)*a;g.drawImage(v,C,T,r,a,t*r-o,e*a-h,r,a)}}}}},cvsRender:function(t){var e=i.Core.instance;if(0!==this.width&&0!==this.height){t.save(),t.setTransform(1,0,0,1,0,0);var n=this._context.canvas;t.drawImage(n,0,0,e.width,e.height),t.restore()}},domRender:function(t){this._image&&(this._style["background-image"]=this._surface._css,this._style[i.ENV.VENDOR_PREFIX+"Transform"]="matrix(1, 0, 0, 1, 0, 0)")}}),i.Group=i.Class.create(i.Node,{initialize:function(){this.childNodes=[],i.Node.call(this),this._rotation=0,this._scaleX=1,this._scaleY=1,this._originX=null,this._originY=null,this.__dirty=!1,[i.Event.ADDED_TO_SCENE,i.Event.REMOVED_FROM_SCENE].forEach(function(t){this.addEventListener(t,function(t){this.childNodes.forEach(function(e){e.scene=this.scene,e.dispatchEvent(t)},this)})},this)},addChild:function(t){t.parentNode&&t.parentNode.removeChild(t),this.childNodes.push(t),t.parentNode=this;var e=new i.Event("childadded");if(e.node=t,e.next=null,this.dispatchEvent(e),t.dispatchEvent(new i.Event("added")),this.scene){t.scene=this.scene;var n=new i.Event("addedtoscene");t.dispatchEvent(n)}},addChildren:function(t){t.forEach(function(t){this.addChild(t)}.bind(this))},insertBefore:function(t,e){t.parentNode&&t.parentNode.removeChild(t);var n=this.childNodes.indexOf(e);if(-1!==n){this.childNodes.splice(n,0,t),t.parentNode=this;var s=new i.Event("childadded");if(s.node=t,s.next=e,this.dispatchEvent(s),t.dispatchEvent(new i.Event("added")),this.scene){t.scene=this.scene;var r=new i.Event("addedtoscene");t.dispatchEvent(r)}}else this.addChild(t)},removeChild:function(t){var e;if(-1!==(e=this.childNodes.indexOf(t))){this.childNodes.splice(e,1),t.parentNode=null;var n=new i.Event("childremoved");if(n.node=t,this.dispatchEvent(n),t.dispatchEvent(new i.Event("removed")),this.scene){t.scene=null;var s=new i.Event("removedfromscene");t.dispatchEvent(s)}}},firstChild:{get:function(){return this.childNodes[0]}},lastChild:{get:function(){return this.childNodes[this.childNodes.length-1]}},rotation:{get:function(){return this._rotation},set:function(t){this._rotation=t,this._dirty=!0}},scaleX:{get:function(){return this._scaleX},set:function(t){this._scaleX=t,this._dirty=!0}},scaleY:{get:function(){return this._scaleY},set:function(t){this._scaleY=t,this._dirty=!0}},originX:{get:function(){return this._originX},set:function(t){this._originX=t,this._dirty=!0}},originY:{get:function(){return this._originY},set:function(t){this._originY=t,this._dirty=!0}},_dirty:{get:function(){return this.__dirty},set:function(t){if(t=!!t,this.__dirty=t,t)for(var e=0,i=this.childNodes.length;i>e;e++)this.childNodes[e]._dirty=!0}}}),i.Matrix=i.Class.create({initialize:function(){this.reset()},reset:function(){this.stack=[],this.stack.push([1,0,0,1,0,0])},makeTransformMatrix:function(t,e){var i=t._x,n=t._y,s=t.width||0,r=t.height||0,a=t._rotation||0,o="number"==typeof t._scaleX?t._scaleX:1,h="number"==typeof t._scaleY?t._scaleY:1,c=a*Math.PI/180,l=Math.cos(c),d=Math.sin(c),u="number"==typeof t._originX?t._originX:s/2,f="number"==typeof t._originY?t._originY:r/2,_=o*l,v=o*d,g=h*d,m=h*l;e[0]=_,e[1]=v,e[2]=-g,e[3]=m,e[4]=-_*u+g*f+i+u,e[5]=-v*u-m*f+n+f},multiply:function(t,e,i){var n=t[0],s=t[2],r=t[4],a=t[1],o=t[3],h=t[5],c=e[0],l=e[2],d=e[4],u=e[1],f=e[3],_=e[5];i[0]=n*c+s*u,i[1]=a*c+o*u,i[2]=n*l+s*f,i[3]=a*l+o*f,i[4]=n*d+s*_+r,i[5]=a*d+o*_+h},multiplyVec:function(t,e,i){var n=e[0],s=e[1],r=t[0],a=t[2],o=t[4],h=t[1],c=t[3],l=t[5];i[0]=r*n+a*s+o,i[1]=h*n+c*s+l}}),i.Matrix.instance=new i.Matrix,i.DetectColorManager=i.Class.create({initialize:function(t,e){this.reference=[],this.colorResolution=t||16,this.max=e||1,this.capacity=Math.pow(this.colorResolution,3);for(var i=1,n=this.capacity;n>i;i++)this.reference[i]=null},attachDetectColor:function(t){var e=this.reference.indexOf(null);return-1===e&&(e=1),this.reference[e]=t,this._getColor(e)},detachDetectColor:function(t){var e=this.reference.indexOf(t);-1!==e&&(this.reference[e]=null)},_getColor:function(t){var e=this.colorResolution,i=e/this.max;return[parseInt(t/e/e%e,10)/i,parseInt(t/e%e,10)/i,parseInt(t%e,10)/i,1]},_decodeDetectColor:function(t){var e=this.colorResolution;return~~(t[0]*e*e*e/256)+~~(t[1]*e*e/256)+~~(t[2]*e/256)},getSpriteByColor:function(t){return this.reference[this._decodeDetectColor(t)]}}),i.DomManager=i.Class.create({initialize:function(t,e){var n=i.Core.instance;this.layer=null,this.targetNode=t,"string"==typeof e?this.element=document.createElement(e):e instanceof HTMLElement&&(this.element=e),this.style=this.element.style,this.style.position="absolute",this.style[i.ENV.VENDOR_PREFIX+"TransformOrigin"]="0px 0px",n._debug&&(this.style.border="1px solid blue",this.style.margin="-1px");var s=this;this._setDomTarget=function(){s.layer._touchEventTarget=s.targetNode},this._attachEvent()},getDomElement:function(){return this.element},getDomElementAsNext:function(){return this.element},getNextManager:function(t){var e=this.targetNode.parentNode.childNodes.indexOf(t.targetNode);return e!==this.targetNode.parentNode.childNodes.length-1?this.targetNode.parentNode.childNodes[e+1]._domManager:null},addManager:function(t,e){var i;e&&(i=e.getDomElementAsNext());var n=t.getDomElement();n instanceof Array?n.forEach(function(t){i?this.element.insertBefore(t,i):this.element.appendChild(t)},this):i?this.element.insertBefore(n,i):this.element.appendChild(n),this.setLayer(this.layer)},removeManager:function(t){t instanceof i.DomlessManager?t._domRef.forEach(function(t){this.element.removeChild(t)},this):this.element.removeChild(t.element),this.setLayer(this.layer)},setLayer:function(t){this.layer=t;var e,i=this.targetNode;if(i.childNodes)for(var n=0,s=i.childNodes.length;s>n;n++)e=i.childNodes[n]._domManager,e&&e.setLayer(t)},render:function(t){var e=this.targetNode,n=i.Matrix.instance,s=n.stack,r=[];n.makeTransformMatrix(e,r),n.multiply(s[s.length-1],r,r),n.multiply(t,r,t),e._matrix=t;var a="number"==typeof e._originX?e._originX:e.width/2||0,o="number"==typeof e._originY?e._originY:e.height/2||0,h=[a,o];n.multiplyVec(r,h,h),e._offsetX=h[0]-a,e._offsetY=h[1]-o,!e.parentNode||e.parentNode instanceof i.Group||(e._offsetX+=e.parentNode._offsetX,e._offsetY+=e.parentNode._offsetY),e._dirty&&(this.style[i.ENV.VENDOR_PREFIX+"Transform"]="matrix("+r[0].toFixed(10)+","+r[1].toFixed(10)+","+r[2].toFixed(10)+","+r[3].toFixed(10)+","+r[4].toFixed(10)+","+r[5].toFixed(10)+")"),this.domRender()},domRender:function(){var t=this.targetNode;t._style||(t._style={}),t.__styleStatus||(t.__styleStatus={}),null!==t.width&&(t._style.width=t.width+"px"),null!==t.height&&(t._style.height=t.height+"px"),t._style.opacity=t._opacity,t._style["background-color"]=t._backgroundColor,"undefined"!=typeof t._visible&&(t._style.display=t._visible?"block":"none"),"function"==typeof t.domRender&&t.domRender(this.element);var e;for(var i in t._style)e=t._style[i],t.__styleStatus[i]!==e&&null!=e&&(this.style.setProperty(i,""+e),t.__styleStatus[i]=e)},_attachEvent:function(){i.ENV.TOUCH_ENABLED&&this.element.addEventListener("touchstart",this._setDomTarget,!0),this.element.addEventListener("mousedown",this._setDomTarget,!0)},_detachEvent:function(){i.ENV.TOUCH_ENABLED&&this.element.removeEventListener("touchstart",this._setDomTarget,!0),this.element.removeEventListener("mousedown",this._setDomTarget,!0)},remove:function(){this._detachEvent(),this.element=this.style=this.targetNode=null}}),i.DomlessManager=i.Class.create({initialize:function(t){this._domRef=[],this.targetNode=t},_register:function(t,e){var i=this._domRef.indexOf(e);t instanceof Array?-1===i?Array.prototype.push.apply(this._domRef,t):Array.prototype.splice.apply(this._domRef,[i,0].concat(t)):-1===i?this._domRef.push(t):this._domRef.splice(i,0,t)},getNextManager:function(t){var e=this.targetNode.parentNode.childNodes.indexOf(t.targetNode);return e!==this.targetNode.parentNode.childNodes.length-1?this.targetNode.parentNode.childNodes[e+1]._domManager:null},getDomElement:function(){var t=[];return this.targetNode.childNodes.forEach(function(e){t=t.concat(e._domManager.getDomElement())}),t},getDomElementAsNext:function(){if(this._domRef.length)return this._domRef[0];var t=this.getNextManager(this);return t?t.element:null},addManager:function(t,e){var n=this.targetNode.parentNode;n&&(null===e&&(e=this.getNextManager(this)),n instanceof i.Scene?n._layers.Dom._domManager.addManager(t,e):n._domManager.addManager(t,e));var s=e?e.getDomElementAsNext():null;this._register(t.getDomElement(),s),this.setLayer(this.layer)},removeManager:function(t){var e,i=this._domRef.indexOf(t.element);-1!==i&&(e=this._domRef[i],e.parentNode.removeChild(e),this._domRef.splice(i,1)),this.setLayer(this.layer)},setLayer:function(t){this.layer=t;var e,i=this.targetNode;if(i.childNodes)for(var n=0,s=i.childNodes.length;s>n;n++)e=i.childNodes[n]._domManager,e&&e.setLayer(t)},render:function(t){var e=i.Matrix.instance,n=e.stack,s=this.targetNode,r=[];e.makeTransformMatrix(s,r),e.multiply(n[n.length-1],r,r),e.multiply(t,r,t),s._matrix=t;var a="number"==typeof s._originX?s._originX:s.width/2||0,o="number"==typeof s._originY?s._originY:s.height/2||0,h=[a,o];e.multiplyVec(r,h,h),s._offsetX=h[0]-a,s._offsetY=h[1]-o,n.push(r)},remove:function(){this._domRef=[],this.targetNode=null}}),i.DomLayer=i.Class.create(i.Group,{initialize:function(){var t=i.Core.instance;i.Group.call(this),this._touchEventTarget=null,this._element=document.createElement("div"),this._element.style.position="absolute",this._domManager=new i.DomManager(this,this._element),this._domManager.layer=this,this.width=t.width,this.height=t.height;var e=[i.Event.TOUCH_START,i.Event.TOUCH_MOVE,i.Event.TOUCH_END];e.forEach(function(t){this.addEventListener(t,function(t){this._scene&&this._scene.dispatchEvent(t)})},this);var n=function(t){var e=t.node,r=t.next,a=t.target,o=r?r._domManager:null;i.DomLayer._attachDomManager(e,n,s),a._domManager.addManager(e._domManager,o);var h=new i.Event(i.Event.RENDER);e._dirty=!0,a._domManager.layer._rendering(e,h)},s=function(t){var e=t.node,r=t.target;r._domManager.removeManager(e._domManager),i.DomLayer._detachDomManager(e,n,s)};this.addEventListener("childremoved",s),this.addEventListener("childadded",n)},width:{get:function(){return this._width},set:function(t){this._width=t,this._element.style.width=t+"px"}},height:{get:function(){return this._height},set:function(t){this._height=t,this._element.style.height=t+"px"}},addChild:function(t){this.childNodes.push(t),t.parentNode=this;var e=new i.Event("childadded");if(e.node=t,e.next=null,this.dispatchEvent(e),t.dispatchEvent(new i.Event("added")),this.scene){t.scene=this.scene;var n=new i.Event("addedtoscene");t.dispatchEvent(n)}},insertBefore:function(t,e){var n=this.childNodes.indexOf(e);if(-1!==n){this.childNodes.splice(n,0,t),t.parentNode=this;var s=new i.Event("childadded");if(s.node=t,s.next=e,this.dispatchEvent(s),t.dispatchEvent(new i.Event("added")),this.scene){t.scene=this.scene;var r=new i.Event("addedtoscene");t.dispatchEvent(r)}}else this.addChild(t)},_startRendering:function(){this.addEventListener("exitframe",this._onexitframe),this._onexitframe()},_stopRendering:function(){this.removeEventListener("exitframe",this._onexitframe),this._onexitframe()},_onexitframe:function(){this._rendering(this,new i.Event(i.Event.RENDER))},_rendering:function(t,e,n){var s;if(n||(n=[1,0,0,1,0,0]),t.dispatchEvent(e),t._domManager.render(n),t.childNodes)for(var r=0,a=t.childNodes.length;a>r;r++)s=t.childNodes[r],this._rendering(s,e,n.slice());t._domManager instanceof i.DomlessManager&&i.Matrix.instance.stack.pop(),t._dirty=!1},_determineEventTarget:function(){var t=this._touchEventTarget;return this._touchEventTarget=null,t===this?null:t}}),i.DomLayer._attachDomManager=function(t,e,n){var s;if(t._domManager||(t.addEventListener("childadded",e),t.addEventListener("childremoved",n),t instanceof i.Group?t._domManager=new i.DomlessManager(t):t._element?t._domManager=new i.DomManager(t,t._element):t._domManager=new i.DomManager(t,"div")),t.childNodes)for(var r=0,a=t.childNodes.length;a>r;r++)s=t.childNodes[r],i.DomLayer._attachDomManager(s,e,n),t._domManager.addManager(s._domManager,null)},i.DomLayer._detachDomManager=function(t,e,n){var s;if(t.removeEventListener("childadded",e),t.removeEventListener("childremoved",n),t.childNodes)for(var r=0,a=t.childNodes.length;a>r;r++)s=t.childNodes[r],t._domManager.removeManager(s._domManager,null),i.DomLayer._detachDomManager(s,e,n);t._domManager.remove(),delete t._domManager},i.CanvasLayer=i.Class.create(i.Group,{initialize:function(){var t=i.Core.instance;i.Group.call(this),this._cvsCache={matrix:[1,0,0,1,0,0],detectColor:"#000000"},this._cvsCache.layer=this,this._element=document.createElement("canvas"),this._element.style.position="absolute",this._element.style.left=this._element.style.top="0px",this._detect=document.createElement("canvas"),this._detect.style.position="absolute",this._lastDetected=0,this.context=this._element.getContext("2d"),this._dctx=this._detect.getContext("2d"),this._colorManager=new i.DetectColorManager(16,256),this.width=t.width,this.height=t.height;var e=[i.Event.TOUCH_START,i.Event.TOUCH_MOVE,i.Event.TOUCH_END];e.forEach(function(t){this.addEventListener(t,function(t){this._scene&&this._scene.dispatchEvent(t)})},this);var n=function(t){var e,r=t.node,a=t.target;e=a instanceof i.CanvasLayer?a._scene._layers.Canvas:a.scene._layers.Canvas,i.CanvasLayer._attachCache(r,e,n,s);var o=new i.Event(i.Event.RENDER);a._dirty&&a._updateCoordinate(),r._dirty=!0,i.Matrix.instance.stack.push(a._matrix),i.CanvasRenderer.instance.render(e.context,r,o),i.Matrix.instance.stack.pop(a._matrix)},s=function(t){var e,r=t.node,a=t.target;e=a instanceof i.CanvasLayer?a._scene._layers.Canvas:a.scene._layers.Canvas,i.CanvasLayer._detachCache(r,e,n,s)};this.addEventListener("childremoved",s),this.addEventListener("childadded",n)},width:{get:function(){return this._width},set:function(t){this._width=t,this._element.width=this._detect.width=t}},height:{get:function(){return this._height},set:function(t){this._height=t,this._element.height=this._detect.height=t}},addChild:function(t){this.childNodes.push(t),t.parentNode=this;var e=new i.Event("childadded");if(e.node=t,e.next=null,this.dispatchEvent(e),t.dispatchEvent(new i.Event("added")),this.scene){t.scene=this.scene;var n=new i.Event("addedtoscene");t.dispatchEvent(n)}},insertBefore:function(t,e){var n=this.childNodes.indexOf(e);if(-1!==n){this.childNodes.splice(n,0,t),t.parentNode=this;var s=new i.Event("childadded");if(s.node=t,s.next=e,this.dispatchEvent(s),t.dispatchEvent(new i.Event("added")),this.scene){t.scene=this.scene;var r=new i.Event("addedtoscene");t.dispatchEvent(r)}}else this.addChild(t)},_startRendering:function(){this.addEventListener("exitframe",this._onexitframe),this._onexitframe(new i.Event(i.Event.RENDER))},_stopRendering:function(){this.removeEventListener("render",this._onexitframe),this._onexitframe(new i.Event(i.Event.RENDER))},_onexitframe:function(){var t=i.Core.instance,e=this.context;e.clearRect(0,0,t.width,t.height);var n=new i.Event(i.Event.RENDER);i.CanvasRenderer.instance.render(e,this,n)},_determineEventTarget:function(t){return this._getEntityByPosition(t.x,t.y)},_getEntityByPosition:function(t,e){var n=i.Core.instance,s=this._dctx;this._lastDetected<n.frame&&(s.clearRect(0,0,this.width,this.height),i.CanvasRenderer.instance.detectRender(s,this),this._lastDetected=n.frame);var r=s.getImageData(t,e,1,1).data;return this._colorManager.getSpriteByColor(r)}}),i.CanvasLayer._attachCache=function(t,e,n,s){var r;if(t._cvsCache||(t._cvsCache={},t._cvsCache.matrix=[1,0,0,1,0,0],t._cvsCache.detectColor="rgba("+e._colorManager.attachDetectColor(t)+")",t.addEventListener("childadded",n),t.addEventListener("childremoved",s)),t.childNodes)for(var a=0,o=t.childNodes.length;o>a;a++)r=t.childNodes[a],i.CanvasLayer._attachCache(r,e,n,s)},i.CanvasLayer._detachCache=function(t,e,n,s){var r;if(t._cvsCache&&(e._colorManager.detachDetectColor(t),t.removeEventListener("childadded",n),t.removeEventListener("childremoved",s),delete t._cvsCache),t.childNodes)for(var a=0,o=t.childNodes.length;o>a;a++)r=t.childNodes[a],i.CanvasLayer._detachCache(r,e,n,s)},i.CanvasRenderer=i.Class.create({render:function(t,e,n){var s,r,a;if(t.save(),e.dispatchEvent(n),this.transform(t,e),("undefined"==typeof e._visible||e._visible)&&(s=e.width,r=e.height,e.compositeOperation&&(t.globalCompositeOperation=e.compositeOperation),t.globalAlpha="number"==typeof e._opacity?e._opacity:1,e._backgroundColor&&(t.fillStyle=e._backgroundColor,t.fillRect(0,0,s,r)),e.cvsRender&&e.cvsRender(t),i.Core.instance._debug&&e._debugColor&&(t.strokeStyle=e._debugColor,t.strokeRect(0,0,s,r)),e._clipping&&(t.beginPath(),t.rect(0,0,s,r),t.clip()),e.childNodes))for(var o=0,h=e.childNodes.length;h>o;o++)a=e.childNodes[o],this.render(t,a,n);t.restore(),i.Matrix.instance.stack.pop()},detectRender:function(t,e){var n,s,r;if("undefined"==typeof e._visible||e._visible){if(n=e.width,s=e.height,t.save(),this.transform(t,e),t.fillStyle=e._cvsCache.detectColor,e._touchEnabled&&(e.detectRender?e.detectRender(t):t.fillRect(0,0,n,s)),e._clipping&&(t.beginPath(),t.rect(0,0,n,s),t.clip()),e.childNodes)for(var a=0,o=e.childNodes.length;o>a;a++)r=e.childNodes[a],this.detectRender(t,r);t.restore(),i.Matrix.instance.stack.pop()}},transform:function(t,e){var n,s,r,a,o=i.Matrix.instance,h=o.stack;e._dirty?(o.makeTransformMatrix(e,e._cvsCache.matrix),n=[],o.multiply(h[h.length-1],e._cvsCache.matrix,n),e._matrix=n,s="number"==typeof e._originX?e._originX:e._width/2||0,r="number"==typeof e._originY?e._originY:e._height/2||0,a=[s,r],o.multiplyVec(n,a,a),e._offsetX=a[0]-s,e._offsetY=a[1]-r,e._dirty=!1):n=e._matrix,h.push(n),t.setTransform.apply(t,n)}}),i.CanvasRenderer.instance=new i.CanvasRenderer,i.Scene=i.Class.create(i.Group,{initialize:function(){var t=i.Core.instance;i.Group.call(this),this.scene=this,this._backgroundColor=null,this._element=document.createElement("div"),this._element.style.position="absolute",this._element.style.overflow="hidden",this._element.style[i.ENV.VENDOR_PREFIX+"TransformOrigin"]="0 0",this._layers={},this._layerPriority=[],this.addEventListener(i.Event.CHILD_ADDED,this._onchildadded),this.addEventListener(i.Event.CHILD_REMOVED,this._onchildremoved),this.addEventListener(i.Event.ENTER,this._onenter),this.addEventListener(i.Event.EXIT,this._onexit);var e=this;this._dispatchExitframe=function(){var t;for(var n in e._layers)t=e._layers[n],t.dispatchEvent(new i.Event(i.Event.EXIT_FRAME))},this.addEventListener(i.Event.CORE_RESIZE,this._oncoreresize),this._oncoreresize(t)},x:{get:function(){return this._x},set:function(t){this._x=t;for(var e in this._layers)this._layers[e].x=t}},y:{get:function(){return this._y},set:function(t){this._y=t;for(var e in this._layers)this._layers[e].y=t}},width:{get:function(){return this._width},set:function(t){this._width=t;for(var e in this._layers)this._layers[e].width=t}},height:{get:function(){return this._height},set:function(t){this._height=t;for(var e in this._layers)this._layers[e].height=t}},rotation:{get:function(){return this._rotation},set:function(t){this._rotation=t;for(var e in this._layers)this._layers[e].rotation=t}},scaleX:{get:function(){return this._scaleX},set:function(t){this._scaleX=t;for(var e in this._layers)this._layers[e].scaleX=t}},scaleY:{get:function(){return this._scaleY},set:function(t){this._scaleY=t;for(var e in this._layers)this._layers[e].scaleY=t}},backgroundColor:{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=this._element.style.backgroundColor=t}},_oncoreresize:function(t){this._element.style.width=t.width+"px",this.width=t.width,this._element.style.height=t.height+"px",this.height=t.height,this._element.style[i.ENV.VENDOR_PREFIX+"Transform"]="scale("+t.scale+")";for(var e in this._layers)this._layers[e].dispatchEvent(t)},addLayer:function(t,e){var n=i.Core.instance;if(!this._layers[t]){var s=new i[t+"Layer"];n.currentScene===this&&s._startRendering(),this._layers[t]=s;var r=s._element;if("number"==typeof e){var a=this._element.childNodes[e];a?this._element.insertBefore(r,a):this._element.appendChild(r),this._layerPriority.splice(e,0,t)}else this._element.appendChild(r),this._layerPriority.push(t);s._scene=this}},_determineEventTarget:function(t){for(var e,i,n=this._layerPriority.length-1;n>=0&&(e=this._layers[this._layerPriority[n]],!(i=e._determineEventTarget(t)));n--);return i||(i=this),i},_onchildadded:function(t){var e,i,n=t.node,s=t.next;n._element?(e="Dom",i=1):(e="Canvas",i=0),this._layers[e]||this.addLayer(e,i),n._layer=this._layers[e],this._layers[e].insertBefore(n,s),n.parentNode=this},_onchildremoved:function(t){var e=t.node;e._layer.removeChild(e),e._layer=null},_onenter:function(){for(var t in this._layers)this._layers[t]._startRendering();i.Core.instance.addEventListener("exitframe",this._dispatchExitframe)},_onexit:function(){for(var t in this._layers)this._layers[t]._stopRendering();i.Core.instance.removeEventListener("exitframe",this._dispatchExitframe)}}),i.LoadingScene=i.Class.create(i.Scene,{initialize:function(){i.Scene.call(this),this.backgroundColor="#000";var t=.4*this.width|0,e=.05*this.width|0,n=.03*t|0,s=new i.Sprite(t,e);s.disableCollection(),s.x=(this.width-t)/2,s.y=(this.height-e)/2;var r=new i.Surface(t,e);r.context.fillStyle="#fff",r.context.fillRect(0,0,t,e),r.context.fillStyle="#000",r.context.fillRect(n,n,t-2*n,e-2*n),s.image=r;var a=0,o=0;this.addEventListener("progress",function(t){a=t.loaded/t.total*1}),s.addEventListener("enterframe",function(){o*=.9,o+=.1*a,r.context.fillStyle="#fff",r.context.fillRect(n,0,(t-2*n)*o,e)}),this.addChild(s),this.addEventListener("load",function(t){var e=i.Core.instance;e.removeScene(e.loadingScene),e.dispatchEvent(t)})}}),i.CanvasScene=i.Class.create(i.Scene,{initialize:function(){i.Scene.call(this),this.addLayer("Canvas")},_determineEventTarget:function(t){var e=this._layers.Canvas._determineEventTarget(t);return e||(e=this),e},_onchildadded:function(t){var e=t.node,i=t.next;e._layer=this._layers.Canvas,this._layers.Canvas.insertBefore(e,i)},_onenter:function(){this._layers.Canvas._startRendering(),i.Core.instance.addEventListener("exitframe",this._dispatchExitframe)},_onexit:function(){this._layers.Canvas._stopRendering(),i.Core.instance.removeEventListener("exitframe",this._dispatchExitframe)}}),i.DOMScene=i.Class.create(i.Scene,{initialize:function(){i.Scene.call(this),this.addLayer("Dom")},_determineEventTarget:function(t){var e=this._layers.Dom._determineEventTarget(t);return e||(e=this),e},_onchildadded:function(t){var e=t.node,i=t.next;e._layer=this._layers.Dom,this._layers.Dom.insertBefore(e,i)},_onenter:function(){this._layers.Dom._startRendering(),i.Core.instance.addEventListener("exitframe",this._dispatchExitframe)},_onexit:function(){this._layers.Dom._stopRendering(),i.Core.instance.removeEventListener("exitframe",this._dispatchExitframe)}}),i.Surface=i.Class.create(i.EventTarget,{initialize:function(t,e){i.EventTarget.call(this);var n=i.Core.instance;this.width=t,this.height=e,this.context=null;var s="enchant-surface"+n._surfaceID++;if(document.getCSSCanvasContext){this.context=document.getCSSCanvasContext("2d",s,t,e),this._element=this.context.canvas,this._css="-webkit-canvas("+s+")";this.context}else document.mozSetImageElement?(this._element=document.createElement("canvas"),this._element.width=t,this._element.height=e,this._css="-moz-element(#"+s+")",this.context=this._element.getContext("2d"),document.mozSetImageElement(s,this._element)):(this._element=document.createElement("canvas"),this._element.width=t,this._element.height=e,this._element.style.position="absolute",this.context=this._element.getContext("2d"),i.ENV.CANVAS_DRAWING_METHODS.forEach(function(t){var e=this.context[t];this.context[t]=function(){e.apply(this,arguments),this._dirty=!0}},this))},getPixel:function(t,e){return this.context.getImageData(t,e,1,1).data},setPixel:function(t,e,i,n,s,r){var a=this.context.createImageData(1,1);a.data[0]=i,a.data[1]=n,a.data[2]=s,a.data[3]=r,this.context.putImageData(a,t,e)},clear:function(){this.context.clearRect(0,0,this.width,this.height)},draw:function(t){if(t=t._element,1===arguments.length)this.context.drawImage(t,0,0);else{var e=arguments;e[0]=t,this.context.drawImage.apply(this.context,e)}},clone:function(){var t=new i.Surface(this.width,this.height);return t.draw(this),t},toDataURL:function(){var t=this._element.src;return t?"data:"===t.slice(0,5)?t:this.clone().toDataURL():this._element.toDataURL()}}),i.Surface.load=function(t,e,n){var s=new Image,r=Object.create(i.Surface.prototype,{context:{value:null},_css:{value:"url("+t+")"},_element:{value:s}});return i.EventTarget.call(r),n=n||function(){},r.addEventListener("load",e),r.addEventListener("error",n),s.onerror=function(){var t=new i.Event(i.Event.ERROR);t.message="Cannot load an asset: "+s.src,i.Core.instance.dispatchEvent(t),r.dispatchEvent(t)},s.onload=function(){r.width=s.width,r.height=s.height,r.dispatchEvent(new i.Event("load"))},s.src=t,r},i.Surface._staticCanvas2DContext=document.createElement("canvas").getContext("2d"),i.Surface._getPattern=function(t,e){return t._pattern&&!e||(t._pattern=this._staticCanvas2DContext.createPattern(t._element,"repeat")),t._pattern},t.Deferred?i.Deferred=t.Deferred:(i.Deferred=i.Class.create({initialize:function(){this._succ=this._fail=this._next=this._id=null,this._tail=this},next:function(t){var e=new i.Deferred;return e._succ=t,this._add(e)},error:function(t){var e=new i.Deferred;return e._fail=t,this._add(e)},_add:function(t){return this._tail._next=t,this._tail=t,this},call:function(t){for(var e,n=this;n&&!n._succ;)n=n._next;if(n instanceof i.Deferred){try{e=n._succ(t)}catch(s){return n.fail(s)}e instanceof i.Deferred?i.Deferred._insert(n,e):n._next instanceof i.Deferred&&n._next.call(e)}},fail:function(t){for(var e,n,s=this;s&&!s._fail;)s=s._next;if(!(s instanceof i.Deferred))throw t instanceof Error?t:(n=new Error("failed in Deferred"),n.arg=t,n);e=s._fail(t),s.call(e)}}),i.Deferred._insert=function(t,e){t._next instanceof i.Deferred&&(e._next=t._next),t._next=e},i.Deferred.next=function(t){var e=(new i.Deferred).next(t);return e._id=setTimeout(function(){e.call()},0),e},i.Deferred.parallel=function(t){var e=new i.Deferred;e._id=setTimeout(function(){e.call()},0);var n=0,s=t instanceof Array?[]:{},r=new i.Deferred;for(var a in t)t.hasOwnProperty(a)&&(n++,function(t,e){t.next(function(t){n--,s[e]=t,0>=n&&r.call(s)}).error(function(t){r.fail(t)}),"number"==typeof t._id&&clearTimeout(t._id),t._id=setTimeout(function(){t.call()},0)}(t[a],a));return n||(r._id=setTimeout(function(){r.call(s)},0)),e.next(function(){return r})}),i.DOMSound=i.Class.create(i.EventTarget,{initialize:function(){throw i.EventTarget.call(this),this.duration=0,new Error("Illegal Constructor")},play:function(){this._element&&this._element.play()},pause:function(){this._element&&this._element.pause()},stop:function(){this.pause(),this.currentTime=0},clone:function(){var t;if(this._element instanceof Audio)t=Object.create(i.DOMSound.prototype,{_element:{value:this._element.cloneNode(!1)},duration:{value:this.duration}});else{if(i.ENV.USE_FLASH_SOUND)return this;t=Object.create(i.DOMSound.prototype)}return i.EventTarget.call(t),t},currentTime:{get:function(){return this._element?this._element.currentTime:0},set:function(t){this._element&&(this._element.currentTime=t)}},volume:{get:function(){return this._element?this._element.volume:1;
},set:function(t){this._element&&(this._element.volume=t)}}}),i.DOMSound.load=function(e,n,s,r){if(null==n){var a=i.Core.findExt(e);n=a?"audio/"+a:""}n=n.replace("mp3","mpeg").replace("m4a","mp4"),r=r||function(){};var o=Object.create(i.DOMSound.prototype);i.EventTarget.call(o),o.addEventListener("load",s),o.addEventListener("error",r);var h=new Audio;if(!i.ENV.SOUND_ENABLED_ON_MOBILE_SAFARI&&"webkit"===i.ENV.VENDOR_PREFIX&&i.ENV.TOUCH_ENABLED)t.setTimeout(function(){o.dispatchEvent(new i.Event("load"))},0);else if(!i.ENV.USE_FLASH_SOUND&&h.canPlayType(n))h.addEventListener("canplaythrough",function(){o.duration=h.duration,o.dispatchEvent(new i.Event("load"))},!1),h.src=e,h.load(),h.autoplay=!1,h.onerror=function(){var t=new i.Event(i.Event.ERROR);t.message="Cannot load an asset: "+h.src,i.Core.instance.dispatchEvent(t),o.dispatchEvent(t)},o._element=h;else if("audio/mpeg"===n){var c=document.createElement("embed"),l="enchant-audio"+i.Core.instance._soundID++;c.width=c.height=1,c.name=l,c.src="sound.swf?id="+l+"&src="+e,c.allowscriptaccess="always",c.style.position="absolute",c.style.left="-1px",o.addEventListener("load",function(){Object.defineProperties(c,{currentTime:{get:function(){return c.getCurrentTime()},set:function(t){c.setCurrentTime(t)}},volume:{get:function(){return c.getVolume()},set:function(t){c.setVolume(t)}}}),o._element=c,o.duration=c.getDuration()}),i.Core.instance._element.appendChild(c),i.DOMSound[l]=o}else t.setTimeout(function(){o.dispatchEvent(new i.Event("load"))},0);return o},t.AudioContext=t.AudioContext||t.webkitAudioContext||t.mozAudioContext||t.msAudioContext||t.oAudioContext,i.WebAudioSound=i.Class.create(i.EventTarget,{initialize:function(){if(!t.AudioContext)throw new Error("This browser does not support WebAudio API.");i.EventTarget.call(this),this.context=i.WebAudioSound.audioContext,this.src=this.context.createBufferSource(),this.buffer=null,this._volume=1,this._currentTime=0,this._state=0,this.connectTarget=i.WebAudioSound.destination},play:function(t){1!==this._state||t||this.src.disconnect(this.connectTarget),2!==this._state&&(this._currentTime=0);var e=this._currentTime,i=this.context;this.src=i.createBufferSource(),null!=i.createGain?this._gain=i.createGain():this._gain=i.createGainNode(),this.src.buffer=this.buffer,this._gain.gain.value=this._volume,this.src.connect(this._gain),this._gain.connect(this.connectTarget),null!=this.src.start?this.src.start(0,e,this.buffer.duration-e-1.192e-7):this.src.noteGrainOn(0,e,this.buffer.duration-e-1.192e-7),this._startTime=i.currentTime-this._currentTime,this._state=1},pause:function(){var t=this.currentTime;t!==this.duration&&(null!=this.src.stop?this.src.stop(0):this.src.noteOff(0),this._currentTime=t,this._state=2)},stop:function(){null!=this.src.stop?this.src.stop(0):this.src.noteOff(0),this._state=0},clone:function(){var t=new i.WebAudioSound;return t.buffer=this.buffer,t},duration:{get:function(){return this.buffer?this.buffer.duration:0}},volume:{get:function(){return this._volume},set:function(t){t=Math.max(0,Math.min(1,t)),this._volume=t,this.src&&(this._gain.gain.value=t)}},currentTime:{get:function(){return Math.max(0,Math.min(this.duration,this.src.context.currentTime-this._startTime))},set:function(t){this._currentTime=t,2!==this._state&&this.play(!1)}}}),i.WebAudioSound.load=function(t,e,n,s){function r(){var e=new i.Event(i.Event.ERROR);e.message="Cannot load an asset: "+t,i.Core.instance.dispatchEvent(e),o.dispatchEvent(e)}var a=(new Audio).canPlayType(e),o=new i.WebAudioSound;n=n||function(){},s=s||function(){},o.addEventListener(i.Event.LOAD,n),o.addEventListener(i.Event.ERROR,s);var h,c;return"maybe"===a||"probably"===a?(h=i.WebAudioSound.audioContext,c=new XMLHttpRequest,c.open("GET",t,!0),c.responseType="arraybuffer",c.onload=function(){h.decodeAudioData(c.response,function(t){o.buffer=t,o.dispatchEvent(new i.Event(i.Event.LOAD))},r)},c.onerror=r,c.send(null)):setTimeout(r,50),o},t.AudioContext&&(i.WebAudioSound.audioContext=new t.AudioContext,i.WebAudioSound.destination=i.WebAudioSound.audioContext.destination),i.Sound=t.AudioContext&&i.ENV.USE_WEBAUDIO?i.WebAudioSound:i.DOMSound,i.Easing={LINEAR:function(t,e,i,n){return i*t/n+e},SWING:function(t,e,i,n){return i*(.5-Math.cos(t/n*Math.PI)/2)+e},QUAD_EASEIN:function(t,e,i,n){return i*(t/=n)*t+e},QUAD_EASEOUT:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},QUAD_EASEINOUT:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},CUBIC_EASEIN:function(t,e,i,n){return i*(t/=n)*t*t+e},CUBIC_EASEOUT:function(t,e,i,n){return i*((t=t/n-1)*t*t+1)+e},CUBIC_EASEINOUT:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},QUART_EASEIN:function(t,e,i,n){return i*(t/=n)*t*t*t+e},QUART_EASEOUT:function(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e},QUART_EASEINOUT:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},QUINT_EASEIN:function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},QUINT_EASEOUT:function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},QUINT_EASEINOUT:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},SIN_EASEIN:function(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e},SIN_EASEOUT:function(t,e,i,n){return i*Math.sin(t/n*(Math.PI/2))+e},SIN_EASEINOUT:function(t,e,i,n){return-i/2*(Math.cos(Math.PI*t/n)-1)+e},CIRC_EASEIN:function(t,e,i,n){return-i*(Math.sqrt(1-(t/=n)*t)-1)+e},CIRC_EASEOUT:function(t,e,i,n){return i*Math.sqrt(1-(t=t/n-1)*t)+e},CIRC_EASEINOUT:function(t,e,i,n){return(t/=n/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e},ELASTIC_EASEIN:function(t,e,i,n,s,r){if(0===t)return e;if(1===(t/=n))return e+i;r||(r=.3*n);var a;return!s||s<Math.abs(i)?(s=i,a=r/4):a=r/(2*Math.PI)*Math.asin(i/s),-(s*Math.pow(2,10*(t-=1))*Math.sin((t*n-a)*(2*Math.PI)/r))+e},ELASTIC_EASEOUT:function(t,e,i,n,s,r){if(0===t)return e;if(1===(t/=n))return e+i;r||(r=.3*n);var a;return!s||s<Math.abs(i)?(s=i,a=r/4):a=r/(2*Math.PI)*Math.asin(i/s),s*Math.pow(2,-10*t)*Math.sin((t*n-a)*(2*Math.PI)/r)+i+e},ELASTIC_EASEINOUT:function(t,e,i,n,s,r){if(0===t)return e;if(2===(t/=n/2))return e+i;r||(r=n*(.3*1.5));var a;return!s||s<Math.abs(i)?(s=i,a=r/4):a=r/(2*Math.PI)*Math.asin(i/s),1>t?-.5*(s*Math.pow(2,10*(t-=1))*Math.sin((t*n-a)*(2*Math.PI)/r))+e:s*Math.pow(2,-10*(t-=1))*Math.sin((t*n-a)*(2*Math.PI)/r)*.5+i+e},BOUNCE_EASEOUT:function(t,e,i,n){return(t/=n)<1/2.75?i*(7.5625*t*t)+e:2/2.75>t?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},BOUNCE_EASEIN:function(t,e,n,s){return n-i.Easing.BOUNCE_EASEOUT(s-t,0,n,s)+e},BOUNCE_EASEINOUT:function(t,e,n,s){return s/2>t?.5*i.Easing.BOUNCE_EASEIN(2*t,0,n,s)+e:.5*i.Easing.BOUNCE_EASEOUT(2*t-s,0,n,s)+.5*n+e},BACK_EASEIN:function(t,i,n,s,r){return r===e&&(r=1.70158),n*(t/=s)*t*((r+1)*t-r)+i},BACK_EASEOUT:function(t,i,n,s,r){return r===e&&(r=1.70158),n*((t=t/s-1)*t*((r+1)*t+r)+1)+i},BACK_EASEINOUT:function(t,i,n,s,r){return r===e&&(r=1.70158),(t/=s/2)<1?n/2*(t*t*(((r*=1.525)+1)*t-r))+i:n/2*((t-=2)*t*(((r*=1.525)+1)*t+r)+2)+i},EXPO_EASEIN:function(t,e,i,n){return 0===t?e:i*Math.pow(2,10*(t/n-1))+e},EXPO_EASEOUT:function(t,e,i,n){return t===n?e+i:i*(-Math.pow(2,-10*t/n)+1)+e},EXPO_EASEINOUT:function(t,e,i,n){return 0===t?e:t===n?e+i:(t/=n/2)<1?i/2*Math.pow(2,10*(t-1))+e:i/2*(-Math.pow(2,-10*--t)+2)+e}},i.ActionEventTarget=i.Class.create(i.EventTarget,{initialize:function(){i.EventTarget.apply(this,arguments)},dispatchEvent:function(t){var e;this.node?(e=this.node,t.target=e,t.localX=t.x-e._offsetX,t.localY=t.y-e._offsetY):this.node=null,null!=this["on"+t.type]&&this["on"+t.type].call(e,t);var i=this._listeners[t.type];if(null!=i){i=i.slice();for(var n=0,s=i.length;s>n;n++)i[n].call(e,t)}}}),i.Timeline=i.Class.create(i.EventTarget,{initialize:function(t){i.EventTarget.call(this),this.node=t,this.queue=[],this.paused=!1,this.looped=!1,this.isFrameBased=!0,this._parallel=null,this._activated=!1,this.addEventListener(i.Event.ENTER_FRAME,this.tick)},_deactivateTimeline:function(){this._activated&&(this._activated=!1,this.node.removeEventListener("enterframe",this._nodeEventListener))},_activateTimeline:function(){this._activated||this.paused||(this.node.addEventListener("enterframe",this._nodeEventListener),this._activated=!0)},setFrameBased:function(){this.isFrameBased=!0},setTimeBased:function(){this.isFrameBased=!1},next:function(t){var e,n=this.queue.shift();if(e=new i.Event("actionend"),e.timeline=this,n.dispatchEvent(e),0===this.queue.length)return this._activated=!1,void this.node.removeEventListener("enterframe",this._nodeEventListener);if(this.looped?(e=new i.Event("removedfromtimeline"),e.timeline=this,n.dispatchEvent(e),n.frame=0,this.add(n)):(e=new i.Event("removedfromtimeline"),e.timeline=this,n.dispatchEvent(e)),t>0||this.queue[0]&&0===this.queue[0].time){var s=new i.Event("enterframe");s.elapsed=t,this.dispatchEvent(s)}},tick:function(t){if(!this.paused&&this.queue.length>0){var e=this.queue[0];if(0===e.frame){var n;n=new i.Event("actionstart"),n.timeline=this,e.dispatchEvent(n)}var s=new i.Event("actiontick");s.timeline=this,this.isFrameBased?s.elapsed=1:s.elapsed=t.elapsed,e.dispatchEvent(s)}},add:function(t){if(!this._activated){var e=this;this._nodeEventListener=function(t){e.dispatchEvent(t)},this.node.addEventListener("enterframe",this._nodeEventListener),this._activated=!0}this._parallel?(this._parallel.actions.push(t),this._parallel=null):this.queue.push(t),t.frame=0;var n=new i.Event("addedtotimeline");return n.timeline=this,t.dispatchEvent(n),n=new i.Event("actionadded"),n.action=t,this.dispatchEvent(n),this},action:function(t){return this.add(new i.Action(t))},tween:function(t){return this.add(new i.Tween(t))},clear:function(){var t=new i.Event("removedfromtimeline");t.timeline=this;for(var e=0,n=this.queue.length;n>e;e++)this.queue[e].dispatchEvent(t);return this.queue=[],this._deactivateTimeline(),this},skip:function(t){var e=new i.Event("enterframe");for(this.isFrameBased?e.elapsed=1:(e.elapsed=t,t=1);t--;)this.dispatchEvent(e);return this},pause:function(){return this.paused||(this.paused=!0,this._deactivateTimeline()),this},resume:function(){return this.paused&&(this.paused=!1,this._activateTimeline()),this},loop:function(){return this.looped=!0,this},unloop:function(){return this.looped=!1,this},delay:function(t){return this.add(new i.Action({time:t})),this},wait:function(t){return this},then:function(t){var e=this;return this.add(new i.Action({onactiontick:function(i){t.call(e.node)},time:0})),this},exec:function(t){this.then(t)},cue:function(t){var e=0;for(var i in t)t.hasOwnProperty(i)&&(this.delay(i-e),this.then(t[i]),e=i)},repeat:function(t,e){return this.add(new i.Action({onactiontick:function(e){t.call(this)},time:e})),this},and:function(){var t=this.queue.pop();if(t instanceof i.ParallelAction)this._parallel=t,this.queue.push(t);else{var e=new i.ParallelAction;e.actions.push(t),this.queue.push(e),this._parallel=e}return this},or:function(){return this},doAll:function(t){return this},waitAll:function(){return this},waitUntil:function(t){var e=this;return this.add(new i.Action({onactionstart:t,onactiontick:function(i){t.call(this)&&e.next()}})),this},fadeTo:function(t,e,i){return this.tween({opacity:t,time:e,easing:i}),this},fadeIn:function(t,e){return this.fadeTo(1,t,e)},fadeOut:function(t,e){return this.fadeTo(0,t,e)},moveTo:function(t,e,i,n){return this.tween({x:t,y:e,time:i,easing:n})},moveX:function(t,e,i){return this.tween({x:t,time:e,easing:i})},moveY:function(t,e,i){return this.tween({y:t,time:e,easing:i})},moveBy:function(t,e,i,n){return this.tween({x:function(){return this.x+t},y:function(){return this.y+e},time:i,easing:n})},hide:function(){return this.then(function(){this.opacity=0})},show:function(){return this.then(function(){this.opacity=1})},removeFromScene:function(){return this.then(function(){this.scene.removeChild(this)})},scaleTo:function(t,e,i){return"number"==typeof i?this.tween({scaleX:arguments[0],scaleY:arguments[1],time:arguments[2],easing:arguments[3]}):this.tween({scaleX:t,scaleY:t,time:e,easing:i})},scaleBy:function(t,e,i){return"number"==typeof i?this.tween({scaleX:function(){return this.scaleX*arguments[0]},scaleY:function(){return this.scaleY*arguments[1]},time:arguments[2],easing:arguments[3]}):this.tween({scaleX:function(){return this.scaleX*t},scaleY:function(){return this.scaleY*t},time:e,easing:i})},rotateTo:function(t,e,i){return this.tween({rotation:t,time:e,easing:i})},rotateBy:function(t,e,i){return this.tween({rotation:function(){return this.rotation+t},time:e,easing:i})}}),i.Action=i.Class.create(i.ActionEventTarget,{initialize:function(t){i.ActionEventTarget.call(this),this.time=null,this.frame=0;for(var e in t)t.hasOwnProperty(e)&&null!=t[e]&&(this[e]=t[e]);var n=this;this.timeline=null,this.node=null,this.addEventListener(i.Event.ADDED_TO_TIMELINE,function(t){n.timeline=t.timeline,n.node=t.timeline.node,n.frame=0}),this.addEventListener(i.Event.REMOVED_FROM_TIMELINE,function(){n.timeline=null,n.node=null,n.frame=0}),this.addEventListener(i.Event.ACTION_TICK,function(t){var e=n.time-(n.frame+t.elapsed);null!=n.time&&0>=e?(n.frame=n.time,t.timeline.next(-e)):n.frame+=t.elapsed})}}),i.ParallelAction=i.Class.create(i.Action,{initialize:function(t){i.Action.call(this,t);this.timeline,this.node;this.actions=[],this.endedActions=[];var e=this;this.addEventListener(i.Event.ACTION_START,function(t){for(var i=0,n=e.actions.length;n>i;i++)e.actions[i].dispatchEvent(t)}),this.addEventListener(i.Event.ACTION_TICK,function(t){var n,s,r={next:function(t){var r=e.actions[n];e.actions.splice(n--,1),s=e.actions.length,e.endedActions.push(r);var a=new i.Event("actionend");a.timeline=this,r.dispatchEvent(a),a=new i.Event("removedfromtimeline"),a.timeline=this,r.dispatchEvent(a)}},a=new i.Event("actiontick");for(a.timeline=r,a.elapsed=t.elapsed,n=0,s=e.actions.length;s>n;n++)e.actions[n].dispatchEvent(a);0===e.actions.length&&t.timeline.next()}),this.addEventListener(i.Event.ADDED_TO_TIMELINE,function(t){for(var i=0,n=e.actions.length;n>i;i++)e.actions[i].dispatchEvent(t)}),this.addEventListener(i.Event.REMOVED_FROM_TIMELINE,function(){this.actions=this.endedActions,this.endedActions=[]})}}),i.Tween=i.Class.create(i.Action,{initialize:function(t){var e={},n={};i.Action.call(this,t),null==this.easing&&(this.easing=function(t,e,i,n){return i*t/n+e});var s=this;this.addEventListener(i.Event.ACTION_START,function(){var i=["frame","time","callback","onactiontick","onactionstart","onactionend"];for(var r in t)if(t.hasOwnProperty(r)){var a;a="function"==typeof t[r]?t[r].call(s.node):t[r],-1===i.indexOf(r)&&(e[r]=s.node[r],n[r]=a)}}),this.addEventListener(i.Event.ACTION_TICK,function(t){var i=0===s.time?1:s.easing(Math.min(s.time,s.frame+t.elapsed),0,1,s.time)-s.easing(s.frame,0,1,s.time);for(var r in n)if(n.hasOwnProperty(r)){if("undefined"==typeof this[r])continue;s.node[r]+=(n[r]-e[r])*i,Math.abs(s.node[r])<1e-7&&(s.node[r]=0)}})}})}(window),function(){enchant.nineleap={assets:["start.png","end.png"]},enchant.nineleap.Core=enchant.Class.create(enchant.Core,{initialize:function(t,e){enchant.Core.call(this,t,e),this.addEventListener("load",function(){var t=this;this.startScene=new enchant.nineleap.SplashScene,this.startScene.image=this.assets["start.png"],this.startScene.addEventListener("touchend",function(){t.started===!1&&(null!=t.onstart&&t.onstart(),t.started=!0,coreStart=!0),t.currentScene===this&&t.popScene(),this.removeEventListener("touchend",arguments.callee)}),this.addEventListener("keydown",function(){this.started===!1&&(null!=this.onstart&&this.onstart(),this.started=!0),t.currentScene===t.startScene&&t.popScene(),this.removeEventListener("keydown",arguments.callee)}),this.endScene=new SplashScene,this.removeEventListener("load",arguments.callee)}),this.scoreQueue=!1,this.started=!1,coreStart=!1},_requestPreload:function(){var t={},e=0,i=0,n=function(){var t=new enchant.Event("progress");t.loaded=++e,t.total=i,enchant.Core.instance.loadingScene.dispatchEvent(t)};return this._assets.concat(this._twitterAssets||[]).concat(this._netpriceData||[]).concat(this._memoryAssets||[]).reverse().forEach(function(e){var s,r;e instanceof Array?(s=e[0],r=e[1]):s=r=e,t[r]||(t[r]=this.load(s,r,n),i++)},this),this.pushScene(this.loadingScene),enchant.Deferred.parallel(t)},end:function(t,e,i){if(void 0!==i&&(this.endScene.image=i),this.pushScene(this.endScene),console.log(t+" "+e),"r.jsgames.jp"===location.hostname){var n=function(){var i=location.pathname.match(/^\/games\/(\d+)/)[1];location.replace(["http://9leap.net/games/",i,"/result","?score=",encodeURIComponent(t),"&result=",encodeURIComponent(e)].join("")),console.log("game end")};this.endScene.addEventListener("touchend",n),window.setTimeout(n,3e3)}enchant.Core.instance.end=function(){}}}),enchant.nineleap.SplashScene=enchant.Class.create(enchant.Scene,{initialize:function(){enchant.Scene.call(this)},image:{get:function(){return this._image},set:function(t){for(this._image=t;this.firstChild;)this.removeChild(this.firstChild);var e=new Sprite(t.width,t.height);e.image=t,e.x=(this.width-t.width)/2,e.y=(this.height-t.height)/2,this.addChild(e)}}})}(),enchant.ui={assets:["img/pad.png","img/apad.png","img/icon0.png","img/font0.png"]},enchant.ui.Pad=enchant.Class.create(enchant.Sprite,{initialize:function(){var t=enchant.Core.instance,e=t.assets["pad.png"];enchant.Sprite.call(this,e.width/2,e.height),this.image=e,this.input={left:!1,right:!1,up:!1,down:!1},this.addEventListener("touchstart",function(t){this._updateInput(this._detectInput(t.localX,t.localY))}),this.addEventListener("touchmove",function(t){this._updateInput(this._detectInput(t.localX,t.localY))}),this.addEventListener("touchend",function(t){this._updateInput({left:!1,right:!1,up:!1,down:!1})})},_detectInput:function(t,e){t-=this.width/2,e-=this.height/2;var i={left:!1,right:!1,up:!1,down:!1};return t*t+e*e>200&&(0>t&&t*t*.1>e&&e>t*t*-.1&&(i.left=!0),t>0&&t*t*.1>e&&e>t*t*-.1&&(i.right=!0),0>e&&e*e*.1>t&&t>e*e*-.1&&(i.up=!0),e>0&&e*e*.1>t&&t>e*e*-.1&&(i.down=!0)),i},_updateInput:function(t){var e=enchant.Core.instance;["left","right","up","down"].forEach(function(i){this.input[i]&&!t[i]&&e.dispatchEvent(new enchant.Event(i+"buttonup")),!this.input[i]&&t[i]&&e.dispatchEvent(new enchant.Event(i+"buttondown"))},this),this.input=t}}),enchant.ui.APad=enchant.Class.create(enchant.Group,{initialize:function(t){var e=enchant.Core.instance,i=e.assets["apad.png"],n=this.width=i.width,s=this.height=i.height;enchant.Group.call(this),this.outside=new enchant.Sprite(n,s);var r=new enchant.Surface(n,s);r.draw(i,0,0,n,s/4,0,0,n,s/4),r.draw(i,0,s/4*3,n,s/4,0,s/4*3,n,s/4),r.draw(i,0,s/4,n/4,s/2,0,s/4,n/4,s/2),r.draw(i,n/4*3,s/4,n/4,s/2,n/4*3,s/4,n/4,s/2),this.outside.image=r,this.inside=new enchant.Sprite(n/2,s/2);var a=new enchant.Surface(n/2,s/2);a.draw(i,n/4,s/4,n/2,s/2,0,0,n/2,s/2),this.inside.image=a,this.r=n/2,this.isTouched=!1,this.vx=0,this.vy=0,this.rad=0,this.dist=0,"direct"===t?this.mode="direct":this.mode="normal",this._updateImage(),this.addChild(this.inside),this.addChild(this.outside),this.addEventListener("touchstart",function(t){this._detectInput(t.localX,t.localY),this._calcPolar(t.localX,t.localY),this._updateImage(t.localX,t.localY),this._dispatchPadEvent("apadstart"),this.isTouched=!0}),this.addEventListener("touchmove",function(t){this._detectInput(t.localX,t.localY),this._calcPolar(t.localX,t.localY),this._updateImage(t.localX,t.localY),this._dispatchPadEvent("apadmove")}),this.addEventListener("touchend",function(t){this._detectInput(this.width/2,this.height/2),this._calcPolar(this.width/2,this.height/2),this._updateImage(this.width/2,this.height/2),this._dispatchPadEvent("apadend"),this.isTouched=!1})},_dispatchPadEvent:function(t){var e=new enchant.Event(t);e.vx=this.vx,e.vy=this.vy,e.rad=this.rad,e.dist=this.dist,this.dispatchEvent(e)},_updateImage:function(t,e){t-=this.width/2,e-=this.height/2,this.inside.x=this.vx*(this.r-10)+25,this.inside.y=this.vy*(this.r-10)+25},_detectInput:function(t,e){t-=this.width/2,e-=this.height/2;var i=Math.sqrt(t*t+e*e),n=e/t,s=Math.atan(n),r=t/Math.abs(t);0===i?(this.vx=0,this.vy=0):0===t?(this.vx=0,"direct"===this.mode?this.vy=e/this.r:(r=e/Math.abs(e),this.vy=Math.pow(e/this.r,2)*r)):i<this.r?"direct"===this.mode?(this.vx=t/this.r,this.vy=e/this.r):(this.vx=Math.pow(i/this.r,2)*Math.cos(s)*r,this.vy=Math.pow(i/this.r,2)*Math.sin(s)*r):(this.vx=Math.cos(s)*r,this.vy=Math.sin(s)*r)},_calcPolar:function(t,e){t-=this.width/2,e-=this.height/2;var i=0,n=0,s=Math.sqrt(t*t+e*e);s>this.r&&(s=this.r),s/=this.r,"normal"===this.mode&&(s*=s),t>=0&&0>e?(i=Math.PI/2*3,n=t/e):0>t&&0>=e?(i=Math.PI,n=e/t):0>=t&&e>0?(i=Math.PI/2,n=t/e):t>0&&e>=0&&(i=0,n=e/t),0!==t&&0!==e||(n=0),this.rad=Math.abs(Math.atan(n))+i,this.dist=s}}),enchant.ui.Button=enchant.Class.create(enchant.Entity,{initialize:function(t,e,i,n){enchant.Entity.call(this),enchant.CanvasLayer&&(this._element="div"),this.width=n||null,this.height=i||null,this.text=t,this.pressed=!1;var s=this._style;s.display="inline-block",s["font-size"]="12px",s.height="2em",s["line-height"]="2em",s["min-width"]="2em",s.padding="2px 10px",s["text-align"]="center",s["font-weight"]="bold",s["border-radius"]="0.5em",e=e||"dark","string"==typeof e?this.theme=enchant.ui.Button.DEFAULT_THEME[e]:this.theme=e,this._applyTheme(this.theme.normal),this.addEventListener("touchstart",function(){this._applyTheme(this.theme.active),this.pressed=!0,this.y++}),this.addEventListener("touchend",function(){this._applyTheme(this.theme.normal),this.pressed=!1,this.y--})},_applyTheme:function(t){var e=this._style,i=enchant.ui.Button.theme2css(t);for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},text:{get:function(){return this._text},set:function(t){this._text=t,enchant.CanvasLayer||(this._element.innerHTML=t)}},size:{get:function(){return this._style.fontSize},set:function(t){this._style.fontSize=t}},font:{get:function(){return this._style.font},set:function(t){this._style.font=t}},color:{get:function(){return this._style.color},set:function(t){this._style.color=t}},cvsRender:function(){},domRender:function(){var t=this._domManager.element;t.innerHTML=this._text,t.style.font=this._font,t.style.color=this._color,t.style.textAlign=this._textAlign}}),enchant.ui.Button.theme2css=function(t){var e="-"+enchant.ENV.VENDOR_PREFIX.toLowerCase()+"-",i={},n=t.background,s=t.border,r=t.textShadow,a=t.boxShadow;return"-ms-"===e?i.background=n.start:i["background-image"]=e+n.type+"("+["top",n.start,n.end]+")",i.color=t.color,i.border=s.color+" "+s.width+" "+s.type,i["text-shadow"]=r.offsetX+"px "+r.offsetY+"px "+r.blur+" "+r.color,i["box-shadow"]=a.offsetX+"px "+a.offsetY+"px "+a.blur+" "+a.color,i},enchant.ui.Button.DEFAULT_THEME={dark:{normal:{color:"#fff",background:{type:"linear-gradient",start:"#666",end:"#333"},border:{color:"#333",width:1,type:"solid"},textShadow:{offsetX:0,offsetY:1,blur:0,color:"#666"},boxShadow:{offsetX:0,offsetY:1,blur:0,color:"rgba(255, 255, 255, 0.3)"}},active:{color:"#ccc",background:{type:"linear-gradient",start:"#333",end:"#000"},border:{color:"#333",width:1,type:"solid"},textShadow:{offsetX:0,offsetY:1,blur:0,color:"#000"},boxShadow:{offsetX:0,offsetY:1,blur:0,color:"rgba(255, 255, 255, 0.3)"}}},light:{normal:{color:"#333",background:{type:"linear-gradient",start:"#fff",end:"#ccc"},border:{color:"#999",width:1,type:"solid"},textShadow:{offsetX:0,offsetY:1,blur:0,color:"#fff"},boxShadow:{offsetX:0,offsetY:1,blur:0,color:"rgba(0, 0, 0, 1)"}},active:{color:"#333",background:{type:"linear-gradient",start:"#ccc",end:"#999"},border:{color:"#666",width:1,type:"solid"},textShadow:{offsetX:0,offsetY:1,blur:0,color:"#ccc"},boxShadow:{offsetX:0,offsetY:1,blur:0,color:"rgba(255, 255, 255, 0.3)"}}},blue:{normal:{color:"#fff",background:{type:"linear-gradient",start:"#04f",end:"#04c"},border:{color:"#026",width:1,type:"solid"},textShadow:{offsetX:0,offsetY:1,blur:0,color:"#666"},boxShadow:{offsetX:0,offsetY:1,blur:0,color:"rgba(0, 0, 0, 0.5)"}},active:{color:"#ccc",background:{type:"linear-gradient",start:"#029",end:"#026"},border:{color:"#026",width:1,type:"solid"},textShadow:{offsetX:0,offsetY:1,blur:0,color:"#000"},boxShadow:"none"}},nazrinBlue:{normal:{color:"hsla(230,50%,70%,1.0)",background:{type:"linear-gradient",start:"hsla(230,50%,50%,1.0)",end:"hsla(230,50%,50%,1.0)"},border:{color:"#026",width:1,type:"solid"},textShadow:{offsetX:0,offsetY:0,blur:0,color:"#666"},boxShadow:{offsetX:0,offsetY:1,blur:0,color:"rgba(0, 0, 0, 0.5)"}},active:{color:"#ccc",background:{type:"linear-gradient",start:"#029",end:"#026"},border:{color:"#026",width:1,type:"solid"},textShadow:{offsetX:0,offsetY:1,blur:0,color:"#000"},boxShadow:"none"}}},enchant.ui.MutableText=enchant.Class.create(enchant.Sprite,{initialize:function(t,e,i){enchant.Sprite.call(this,0,0),this.fontSize=16,this.widthItemNum=16,this.x=t,this.y=e,this._imageAge=Number.MAX_VALUE,this.text="",arguments[2]&&(this.row=Math.floor(arguments[2]/this.fontSize))},setText:function(t){var e,i,n,s,r;this._text=t;for(this.returnLength?this.width=Math.min(this.returnLength*this.fontSize,enchant.Game.instance.width):this.width=Math.min(this.fontSize*this._text.length,enchant.Game.instance.width),this.height=this.fontSize*(Math.ceil(this._text.length/this.row)||1),!this.image||this.width>this.image.width||this.height>this.image.height||this._imageAge>300?(this.image=new enchant.Surface(this.width,this.height),this._imageAge=0):this.width<this.image.width||this.height<this.image.height?this._imageAge++:this._imageAge=0,this.image.context.clearRect(0,0,this.width,this.height),e=0;e<t.length;e++)s=t.charCodeAt(e),r=s>=32&&127>=s?s-32:0,i=r%this.widthItemNum,n=r/this.widthItemNum|0,this.image.draw(enchant.Game.instance.assets["img/font0.png"],i*this.fontSize,n*this.fontSize,this.fontSize,this.fontSize,e%this.row*this.fontSize,(e/this.row|0)*this.fontSize,this.fontSize,this.fontSize)},text:{get:function(){return this._text},set:function(t){this.setText(t)}},row:{get:function(){return this.returnLength||this.width/this.fontSize},set:function(t){this.returnLength=t,this.text=this.text}}}),enchant.ui.ScoreLabel=enchant.Class.create(enchant.ui.MutableText,{initialize:function(t,e){switch(enchant.ui.MutableText.call(this,0,0),arguments.length){case 2:this.y=e,this.x=t;break;case 1:this.x=t}this._score=0,this._current=0,this.easing=2.5,this.text=this.label="",this.addEventListener("enterframe",function(){if(0===this.easing)this.text=this.label+(this._current=this._score);else{var t=this._score-this._current;t>0?this._current+=Math.ceil(t/this.easing):0>t&&(this._current+=Math.floor(t/this.easing)),this.text=this.label+this._current}})},score:{get:function(){return this._score},set:function(t){this._score=t}}}),enchant.ui.TimeLabel=enchant.Class.create(enchant.ui.MutableText,{initialize:function(t,e,i){switch(enchant.ui.MutableText.call(this,0,0),arguments.length){case 3:case 2:this.y=e,this.x=t;break;case 1:this.x=t}this._time=0,this._count=1,"countdown"===i&&(this._count=-1),this.text=this.label="TIME:",this.addEventListener("enterframe",function(){this._time+=this._count,this.text=this.label+(this._time/enchant.Game.instance.fps).toFixed(2)})},time:{get:function(){return Math.floor(this._time/enchant.Game.instance.fps)},set:function(t){this._time=t*enchant.Game.instance.fps}}}),enchant.ui.LifeLabel=enchant.Class.create(enchant.Group,{initialize:function(t,e,i){enchant.Group.call(this),this.x=t||0,this.y=e||0,this._maxlife=i||9,this._life=0,this.label=new enchant.ui.MutableText(0,0,80),this.label.text="LIFE:",this.addChild(this.label),this.heart=[];for(var n=0;n<this._maxlife;n++)this.heart[n]=new enchant.Sprite(16,16),this.heart[n].image=enchant.Game.instance.assets["img/icon0.png"],this.heart[n].x=this.label.width+16*n,this.heart[n].y=-3,this.heart[n].frame=10,this.addChild(this.heart[n])},life:{get:function(){return this._life},set:function(t){this._life=t,this._maxlife<t&&(this._life=this._maxlife);for(var e=0;e<this._maxlife;e++)this.heart[e].visible=t-1>=e}}}),enchant.ui.Bar=enchant.Class.create(enchant.Sprite,{initialize:function(t,e){switch(enchant.Sprite.call(this,1,16),this.image=new enchant.Surface(1,16),this.image.context.fillColor="RGB(0, 0, 256)",this.image.context.fillRect(0,0,1,16),this._direction="right",this._origin=0,this._maxvalue=enchant.Game.instance.width,this._lastvalue=0,this.value=0,this.easing=5,arguments.length){case 2:this.y=e,this.x=t,this._origin=t;break;case 1:this.x=t,this._origin=t}this.addEventListener("enterframe",function(){this.value<0&&(this.value=0),this._lastvalue+=(this.value-this._lastvalue)/this.easing,Math.abs(this._lastvalue-this.value)<1.3&&(this._lastvalue=this.value),this.width=0|this._lastvalue,this.width>this._maxvalue&&(this.width=this._maxvalue),"left"===this._direction?this._x=this._origin-this.width:this._x=this._origin,this._updateCoordinate()})},direction:{get:function(){return this._direction},set:function(t){"right"!==t&&"left"!==t||(this._direction=t)}},x:{get:function(){return this._origin},set:function(t){this._x=t,this._origin=t,this._dirty=!0}},maxvalue:{get:function(){return this._maxvalue},set:function(t){this._maxvalue=t}}}),enchant.ui.VirtualMap=enchant.Class.create(enchant.Group,{initialize:function(t,e){enchant.Group.call(this),this.meshWidth=t||16,this.meshHeight=e||16},addChild:function(t){enchant.Group.prototype.addChild.call(this,t),this.bind(t)},insertBefore:function(t,e){enchant.Group.prototype.insertBefore.call(this,t,e),this.bind(t)},bind:function(t){Object.defineProperties(t,{mx:{get:function(){return Math.floor(this.x/this.parentNode.meshWidth)},set:function(t){this.x=Math.floor(t*this.parentNode.meshWidth)}},my:{get:function(){return Math.floor(this.y/this.parentNode.meshHeight)},set:function(t){this.y=Math.floor(t*this.parentNode.meshWidth)}}}),t.mx=0,t.my=0}}),enchant();var MyLabel=Class.create(Label,{initialize:function(t,e,i,n,s){Label.call(this,t),this.x=e,this.y=i,this.fontSize=n,this._fontSize=n+"px"||"16px",this.fontStyle=s||"sans-serif",this.font=this._fontSize+" "+this.fontStyle},setPosition:function(t,e){this.x=t,this.y=e}}),MyButton=Class.create(Group,{isPressed:!1,isToggle:!1,visible:!0,initialize:function(t,e,i,n){Group.call(this),n&&(this.isToggle=n);var s=t.length;this.fontSize=null!==e||void 0!==e?e:16,this.fontStyle="'', 'Meiryo', 'sans-serif', 'monospace'",this.width=this.fontSize*(s+1),this.height=1.5*this.fontSize;var r=function(t,e,i,n){var s="hsla("+t+","+e+"%,"+i+"%,"+n+")";return s},a=i||120,o=50;this.mainColor=r(a,50,o,1),this.lighterColor=r(a,50,o+16,1),this.darkerColor=r(a,50,o-16,1),this.fontColor=r(a,50,o-24,1),this.radius=.4*this.fontSize,this.buttonLabel=new Label(t),this._fontSize=this.fontSize+"px",this.buttonLabel.font=this._fontSize+" "+this.fontStyle,this.buttonLabel.x=.5*this.fontSize,this.buttonLabel.y=.1*this.fontSize,this.buttonImage=new Sprite(this.width,this.height),this._buttonSurface=new Surface(this.buttonImage.width,this.buttonImage.height),this.buttonImage.image=this._buttonSurface,this.addChildren([this.buttonImage,this.buttonLabel])},onenterframe:function(){this.visible?this.childNodes.forEach(function(t){"undefined"!=typeof t.visible&&(t.visible=!0)}):this.childNodes.forEach(function(t){"undefined"!=typeof t.visible&&(t.visible=!1)}),this.buttonLabel.color=this.fontColor,this.drawButton()},ontouchstart:function(){return this.isToggle?void(this.isPressed?this.isPressed=!1:this.isPressed=!0):void(this.isPressed=!1)},ontouchend:function(){this.isToggle||(this.isPressed=!1)},drawButton:function(){var t=this._buttonSurface.context;t.fillStyle=this.mainColor,this.roundRect(t,0,0,this.width,this.height,this.radius,!0,!1),t.globalCompositeOperation="source-atop",this.isPressed?(t.fillStyle=this.mainColor,this.fontColor=this.lighterColor,this.roundRect(t,.05*this.height,.05*this.height,this.width,this.height,this.radius,!0,!1)):(t.fillStyle=this.lighterColor,this.fontColor=this.darkerColor,this.roundRect(t,.05*-this.height,.05*-this.height,this.width,this.height,this.radius,!0,!1));
},roundRect:function(t,e,i,n,s,r,a,o){"undefined"==typeof o&&(o=!0),"undefined"==typeof r&&(r=5),t.beginPath(),t.moveTo(e+r,i),t.lineTo(e+n-r,i),t.quadraticCurveTo(e+n,i,e+n,i+r),t.lineTo(e+n,i+s-r),t.quadraticCurveTo(e+n,i+s,e+n-r,i+s),t.lineTo(e+r,i+s),t.quadraticCurveTo(e,i+s,e,i+s-r),t.lineTo(e,i+r),t.quadraticCurveTo(e,i,e+r,i),t.closePath(),o&&t.stroke(),a&&t.fill()}}),MySprite=Class.create(Sprite,{initialize:function(t,e,i,n,s,r){Sprite.call(this,e,i),this.image=t,this.x=n||0,this.y=s||0,this.frame=null!==r||void 0!==r?r:0,this.itemLevel=null},setScale:function(t){this.scaleX=t,this.scaleY=t}}),HorizontalGauge=Class.create(Sprite,{initialize:function(t,e,i){Sprite.call(this,t,e),this.value=i,this.maxValue=i,this._maxWidth=t,this.remainingRatio;this._image=new Surface(this.width,this.height),this.image=this._image},onenterframe:function(){this.value>this.maxValue&&(this.value=this.maxValue),this.remainingRatio=this.value/this.maxValue<1?this.value/this.maxValue:1,this.width=this._maxWidth*this.remainingRatio,this.value<this.maxValue&&(this.value+=.002*this.maxValue),this.remainingRatio<.2?this._redraw("red"):this._redraw("hsl(240,50%,60%)")},setValue:function(t){this.value>t,this.value=t},getValue:function(){return this.value},_redraw:function(t){var e=this._image.context;e.fillStyle=t,e.fillRect(0,0,this.width,this.height)}}),Dust=Class.create(Sprite,{initialize:function(t,e,i,n,s){Sprite.call(this,i,n);var r=this,a=enchant.Easing.SIN_EASEOUT;this.x=t,this.y=e,this.duration=s||30,this.visible=!1,this.backgroundColor="rgb(209,128,71)",this.tl.then(function(){this.visible=!0}).scaleTo(.5,this.duration,a).and().fadeOut(this.duration,a).and().rotateTo(360,this.duration,a).and().moveBy(0,-32,this.duration,a).then(function(){r.destroy()})},destroy:function(){this.parentNode.removeChild(this)}});enchant(),window.onload=function(){var t=368,e=288,i=256,n=t/2,s=e/2,r=.2,a=1e3,o=["SUGOI !!!","GOOD","IMAICHI..."],h=["","","",""],c=0,l=0,d=null,u=[["",0,1],["P",1,1],["",2,1],["",3,2],["",4,2],["",5,2],["",6,3],["",7,3],["",8,3]],f=Math.floor((new Date).getTime()/1e3);f%8===0?u.push(["",10,4]):u.push(["",9,4]);var _=0;u.forEach(function(t){_+=t[2]});var v=u.length,g=0,m=null,p=null,E=!0,y=!1,w=!1;Sound.enabledInMobileSafari=!0;var x=new Core(t,e);x.fps=30,x.scale=1,x.preload("img/title/startButton.png","img/title/titleNaz.png","img/title/BG.png","img/title/logo.png","img/map0.png","img/baseWindow.png","img/window01.png","img/targets.png","img/emotion.png","img/nazrins.png","img/dust.png","img/resultTitle.png","img/others.png","img/tutorialBG.png","sound/mp3/HaruMinato.mp3","sound/wav/se_search.wav","sound/wav/se_close.wav","sound/wav/se_veryClose.wav","sound/wav/se_findIt.wav","sound/wav/se_snap.wav"),x.onload=function(f){function C(){var t=setInterval(function(){dt--,ut.score=dt,0===dt?(ut.score="",ft.visible=1):-1===dt&&(dt=3,ut.score=dt,ft.visible=0,x.popScene(),clearTimeout(t),T())},700)}function T(){c=0,It.score=c,g=0,Pt.frame=0,Bt.value=Bt.maxValue,p=u.concat(),kt.visible=!1,S(),b(Xt)}function b(t){t.forEach(function(t){t.visible=!t.visible})}function S(){var t;t=p.length>2?Math.floor(Math.random()*(p.length-1)):0;var n=p[t],s=(n[0],n[1]),r=n[2],a=!!w;p.splice(t,1),d=new Yt(i-32,e-32,s,r,a),Z.addChild(d),Lt.frame=s,At.text=r.toString(),E=!1}function M(t){c+=t,It.score=c,Rt.text="+"+t}function N(){x.pushScene(J),mt.text=c,Et.text=O(c,a*_),_t.x=t/3-20,_t.y=s,_t.tl.fadeIn(8).and().moveBy(20,0,8),setTimeout(function(){_t.opacity=0,Et.x=2*-Et.width;var e=t-Et.width;Et.tl.delay(16).tween({opacity:1,x:e,time:32,easing:enchant.Easing.QUAD_EASEOUT}),x.pushScene($)},2e3),c>l&&(l=c,ht.text=c.toString())}function O(t,e){var i=h,n=e,s=.4*n,r=.6*n,a=.8*n,o=function(t){return w?"EX"+t:t};return s>t?o(i[0]):t>=s&&r>t?o(i[1]):t>=r&&a>t?o(i[2]):(y=!0,o(i[3]))}var A=x.assets["sound/mp3/HaruMinato.mp3"],L=x.assets["sound/wav/se_findIt.wav"].clone(),D=x.assets["sound/wav/se_search.wav"].clone(),I=x.assets["sound/wav/se_close.wav"].clone(),R=x.assets["sound/wav/se_veryClose.wav"].clone(),k=x.assets["sound/wav/se_snap.wav"].clone(),P=[A,L,D,I,R,k],U=x.assets["img/title/logo.png"],B=x.assets["img/title/BG.png"],X=x.assets["img/title/titleNaz.png"],Y=x.assets["img/title/startButton.png"],z=x.assets["img/tutorialBG.png"],F=x.assets["img/emotion.png"],V=(x.assets["img/baseWindow.png"],x.assets["img/window01.png"]),H=x.assets["img/targets.png"],G=x.assets["img/nazrins.png"],W=x.assets["img/resultTitle.png"],q=x.assets["img/others.png"],j=x.rootScene,K=new Scene,Q=new Scene,Z=new Scene,J=new Scene,$=new Scene,tt=new MySprite(B,640,480,0,0),et=new MySprite(U,401,188);et.setScale(.7),et.x=n-.5*et.width,et.y=-240;var it=.4*e-.5*et.height,nt=new MySprite(X,256,344,200,32);nt.setScale(.6);var st=new MySprite(Y,235,43,0,s+50);st.setScale(.8),st.x=n-.5*st.width;var rt=new MyButton("",20,230);rt.moveTo(n-.5*rt.width,st.y+50);var at=new MyButton("EX",18);at.moveTo(t-64,8),at.width-=8,at.isToggle=!0,at.visible=!1,at.on("touchstart",function(){w=!w});var ot=new MutableText(4,4);ot.text="Hi-SCORE";var ht=new MutableText(4,20);ht.text=l.toString(),j.addChildren([tt,nt,et,st,rt,ot,ht,at]),j.tl.cue({15:function(){et.tl.moveTo(et.x,it,55,enchant.Easing.BOUNCE_EASEOUT)},40:function(){st.tl.fadeIn(30).fadeOut(30).loop()}}),st.on("touchend",function(){et.tl.skip(100),x.replaceScene(Z),b(Xt),x.pushScene(Q),C()}),rt.on("touchend",function(){k.stop(),k.play(),x.pushScene(K),et.tl.skip(100)}),K.backgroundColor="rgba(0,0,0,1)";var ct=new MySprite(z,t,e),lt=new MyLabel("",240,4,12,"meirio");lt.color="rgb(230,230,230)",K.addChildren([ct,lt]),K.on("touchend",function(){k.stop(),k.play(),x.popScene()}),Q.backgroundColor="rgba(0, 0, 0, 0.5)";var dt=3,ut=new ScoreLabel(n-50,s);ut.score=dt;var ft=new MutableText(null,ut.y+24);ft.text="START!!",ft.x=n-.75*ft.width,ft.visible=0,Q.addChildren([ut,ft]),J.backgroundColor="rgba(0, 0, 0, 0.5)";var _t=new Label("");_t.font='30px "HG"',_t.color="rgba(0, 255, 255, 1)",_t.opacity=0,J.addChild(_t),$.backgroundColor="rgba(255, 220, 59, 1)";var vt=new MySprite(W,174,63);vt.moveTo(n-.5*vt.width,.05*e);var gt=new MyLabel("",null,.3*e,32,"HG");gt.x=.1*t,gt.color="rgba(112, 255, 255, 1)";var mt=new MyLabel("(dummyText)",.5*t,.3*e);mt.font='48px "Sigmar One","Impact"',mt.color="rgba(0, 255, 255, 0.7)",mt.strokeColor="rgba(0, 202, 100, 0.7)";var pt=new MyLabel("...",null,null,20,"HG");pt.x=gt.x,pt.y=mt.y+60,pt.color="rgba(0, 255, 255, 0.9)";var Et=new MyLabel("(dummy)",null,null,28,"HG");Et.y=pt.y+30,Et.color=pt.color,Et.strokeColor="rgba(0, 20, 230, 0.9)",Et.opacity=0;var yt=new MyButton("",20,100);yt.moveTo(Math.floor(n-yt.width/2),Math.floor(12*e/16)),yt.on("touchend",function(){at.visible=!!y,x.replaceScene(j)});var wt=new MyButton("",20,50);wt.moveTo(Math.floor(n-wt.width/2),Math.floor(14*e/16)),wt.on("touchend",function(){x.end(c,"[:"+c+"] "+Et.text)}),$.addChildren([vt,gt,mt,pt,Et,yt,wt]),j.on("enterframe",function(){A.src||A.play()}),Z.on("enterframe",function(){A.src||A.play()}),$.on("enterframe",function(){A.src||A.play()}),P.forEach(function(t){t.src?(t._volume=0,t.play(),t==A&&(t.src.loop=!0)):t.volume=0});var xt=new MySprite(q,32,32);xt.x=t-1.2*xt.width,xt.y=e-1.2*xt.width,xt.frame=2;var Ct=function(){0==A.volume?(P.forEach(function(t){t==A&&(t.stop(),t.play(),t.src&&(t.src.loop=!0)),t.volume=r}),xt.frame=1):(P.forEach(function(t){t.volume=0}),xt.frame=2)};xt.on("touchend",Ct),j.addChild(xt);var Tt=new Group;Tt.x=i;var bt=[null,2,18,19,23],St=new Map(16,16);St.image=x.assets["img/map0.png"],St.loadData([[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],[mapArrayMaker(16,bt),mapArrayMaker(16,bt),mapArrayMaker(16,bt),mapArrayMaker(16,bt),mapArrayMaker(16,bt),mapArrayMaker(16,bt),mapArrayMaker(16,bt),mapArrayMaker(16,bt),mapArrayMaker(16,bt),mapArrayMaker(16,bt),mapArrayMaker(16,bt),mapArrayMaker(16,bt),mapArrayMaker(16,bt),mapArrayMaker(16,bt),mapArrayMaker(16,bt),mapArrayMaker(16,bt)]);var Mt=new Map(16,16);Mt.image=x.assets["img/baseWindow.png"],Mt.loadData([[0,1,1,1,1,1,2],[3,4,4,4,4,4,5],[3,4,4,4,4,4,5],[3,4,4,4,4,4,5],[3,4,4,4,4,4,5],[3,4,4,4,4,4,5],[3,4,4,4,4,4,5],[3,4,4,4,4,4,5],[3,4,4,4,4,4,5],[3,4,4,4,4,4,5],[3,4,4,4,4,4,5],[3,4,4,4,4,4,5],[3,4,4,4,4,4,5],[3,4,4,4,4,4,5],[3,4,4,4,4,4,5],[3,4,4,4,4,4,5],[3,4,4,4,4,4,5],[6,7,7,7,7,7,8]]),targetWindow=new Map(16,16),targetWindow.image=V,targetWindow.opacity=.8,targetWindow.loadData([[0,1,1,2],[3,4,4,5],[3,4,4,5],[6,7,7,8]]),targetWindow.moveTo(24,24);var Nt=new MyButton("",12,50);Nt.moveTo(t-Nt.width-4,4),Nt.on("touchstart",function(){return confirm("")?(kt.visible=!1,null!==d&&d.destroy(),x.replaceScene(j),void 0):void(Nt.isPressed=!1)});var Ot=new MutableText(24,targetWindow.y+64+8);Ot.text="LV:";var At=new MutableText(Ot.x+50,Ot.y);At.text="0";var Lt=new Sprite(32,32);Lt.image=H,Lt.x=targetWindow.x+Lt.width/2,Lt.y=targetWindow.y+Lt.height/2,Lt.frame=m;var Dt=new MutableText(16,7*e/16);Dt.text="SCORE";var It=new ScoreLabel(Dt.x,Dt.y+20);It.score=c;var Rt=new MutableText(It.x,It.y+20);Rt.text="";var kt=new MySprite(F,32,32);kt.moveTo(40,11*e/16|0),kt.visible=!1;var Pt=new MySprite(G,32,32,kt.x,kt.y+1.2*kt.height,0),Ut=new MutableText(8,e-32);Ut.text="YARUKI";var Bt=new HorizontalGauge(240,8,120);Bt.x=Ut.x,Bt.y=Ut.y+16,Bt.opacity=.7,Tt.addChildren([Mt,targetWindow,Ot,At,Lt,Rt,It,Dt,Pt,kt]),Z.addChildren([St,Tt,Ut,Bt,Nt]);var Xt=[It,Lt,At,Bt,Nt],Yt=Class.create(Sprite,{TIME_LIMIT:a,FADE_DURATION:25,counter:0,score:null,initialize:function(t,e,i,n,s){Sprite.call(this,32,32),this.x=rand(t-this.width/2),this.y=rand(e-this.height/2),this.frame=i,this.opacity=0,this.image=H,this.difficulty=n||0,this.isMoving=null!==s||void 0!==s?s:!1,this.vector={x:.5*(rand(3)+1),y:.5*(rand(3)+1)},this.rateMessage=new MyLabel("dummytext",8,16),this.rateMessage.color="gold",this.rateMessage.strokeColor="brown",this.rateMessage.font='24px "Sigmar One","Impact"'},onenterframe:function(){this.counter++,this.isMoving&&((this.x<0||this.x>i-this.width)&&(this.vector.x=-1*this.vector.x,this.vector.y=-1*this.vector.y),(this.y<0||this.y>e-this.height)&&(this.vector.x=-1*this.vector.x,this.vector.y=-1*this.vector.y),this.x+=this.vector.x,this.y+=this.vector.y),this.counter>this.TIME_LIMIT&&(this.opacity=.25)},detected:function(){E=!0,g++,this.isMoving=!1,this.opacity=1;var t=this.TIME_LIMIT-this.counter>0?this.TIME_LIMIT-this.counter:0;this.score=Math.floor(t*this.difficulty),M(this.score),console.log(""+this.counter);var e=this.getDetectRating(this.counter);this.rateMessage.text=o[e],this.parentNode.addChild(this.rateMessage),this.rateMessage.tl.tween({opacity:1,x:this.rateMessage.x+8,time:8}).delay(16).moveBy(32,0,32,enchant.Easing.BACK_EASEIN).and().fadeOut(32).then(function(){this.tl.removeFromScene()}),this._fadeAnimation()},getDetectRating:function(t){var e=.2*this.TIME_LIMIT,i=.5*this.TIME_LIMIT;return e>=t?0:t>e&&i>=t?1:2},_fadeAnimation:function(){this.tl.fadeOut(this.FADE_DURATION).and().moveBy(0,-18,this.FADE_DURATION).then(function(){this.callback()}.bind(this))},callback:function(){Rt.text="",kt.visible=!1,this.destroy(),g===v?(this.rateMessage.tl.skip(9999),N()):S()},destroy:function(){this.parentNode.removeChild(this)}});Z.on("touchstart",function(t){var e=Math.abs(t.x-(d.x+d.width/2)),n=Math.abs(t.y-(d.y+d.height/2)),s=Math.sqrt(e*e+n*n),r={veryClose:18-2.5*d.difficulty,close:34-3*d.difficulty,far:54-3*d.difficulty},a=function(){E=!0,setTimeout(function(){E=!1},200)},o=function(t,e,i,n){t.stop(),t.play(),kt.visible=i,kt.frame=e||0,Pt.frame=n||0},h=function(){for(var e=0;8>e;e++){var i=t.x+randInt(-8,8),n=t.y+randInt(-8,8),s=new Dust(i,n,8,8,30);this.addChild(s)}}.bind(this);E===!0||t.x>i||Bt.value<10||(s<r.veryClose?(E=!0,o(L,9,!0,3),d.detected(),Bt.value+=20):s>r.veryClose&&s<r.close?(o(R,0,!0,2),Bt.value-=4,h(),a()):s>r.close&&s<r.far?(o(I,4,!0,1),Bt.value-=6,h(),a()):(o(D,41,!0,0),Bt.value-=6,h(),Bt.remainingRatio<.2&&(Pt.frame=4),a()))})},x.start()};